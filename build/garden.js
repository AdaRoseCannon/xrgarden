import{V as e,M as t,T as i,Q as n,S as r,a as s,E as a,G as o,W as l,b as c,P as u,D as h,c as d,d as p,e as A,A as f,B as m,f as g,R as v,g as y,h as w,i as b,L as E,j as x,F as S,C as M,k as _,l as T,I as R,m as P,n as F,o as C,p as I,q as L,r as D,s as O,t as B,u as N,v as k,w as G,x as U,y as H,z as V,H as z,J as Q,K as j,N as X,O as W,U as Y,X as q,Y as Z,Z as K,_ as J,$,a0 as ee,a1 as te,a2 as ie,a3 as ne,a4 as re,a5 as se,a6 as ae,a7 as oe,a8 as le,a9 as ce,aa as ue,ab as he,ac as de,ad as pe,ae as Ae,af as fe,ag as me,ah as ge,ai as ve,aj as ye,ak as we,al as be,am as Ee,an as xe,ao as Se,ap as Me,aq as _e,ar as Te,as as Re}from"./three.js";var Pe=function(a,o){var l,c,u,h,d,p;void 0===o&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=a,this.domElement=o,this.enabled=!0,this.target=new e,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:t.ROTATE,MIDDLE:t.DOLLY,RIGHT:t.PAN},this.touches={ONE:i.ROTATE,TWO:i.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return b.phi},this.getAzimuthalAngle=function(){return b.theta},this.saveState=function(){A.target0.copy(A.target),A.position0.copy(A.object.position),A.zoom0=A.object.zoom},this.reset=function(){A.target.copy(A.target0),A.object.position.copy(A.position0),A.object.zoom=A.zoom0,A.object.updateProjectionMatrix(),A.dispatchEvent(f),A.update(),y=v.NONE},this.update=(l=new e,c=(new n).setFromUnitVectors(a.up,new e(0,1,0)),u=c.clone().inverse(),h=new e,d=new n,p=2*Math.PI,function(){var e=A.object.position;l.copy(e).sub(A.target),l.applyQuaternion(c),b.setFromVector3(l),A.autoRotate&&y===v.NONE&&B(2*Math.PI/60/60*A.autoRotateSpeed),A.enableDamping?(b.theta+=E.theta*A.dampingFactor,b.phi+=E.phi*A.dampingFactor):(b.theta+=E.theta,b.phi+=E.phi);var t=A.minAzimuthAngle,i=A.maxAzimuthAngle;return isFinite(t)&&isFinite(i)&&(t<-Math.PI?t+=p:t>Math.PI&&(t-=p),i<-Math.PI?i+=p:i>Math.PI&&(i-=p),b.theta=t<i?Math.max(t,Math.min(i,b.theta)):b.theta>(t+i)/2?Math.max(t,b.theta):Math.min(i,b.theta)),b.phi=Math.max(A.minPolarAngle,Math.min(A.maxPolarAngle,b.phi)),b.makeSafe(),b.radius*=x,b.radius=Math.max(A.minDistance,Math.min(A.maxDistance,b.radius)),!0===A.enableDamping?A.target.addScaledVector(S,A.dampingFactor):A.target.add(S),l.setFromSpherical(b),l.applyQuaternion(u),e.copy(A.target).add(l),A.object.lookAt(A.target),!0===A.enableDamping?(E.theta*=1-A.dampingFactor,E.phi*=1-A.dampingFactor,S.multiplyScalar(1-A.dampingFactor)):(E.set(0,0,0),S.set(0,0,0)),x=1,!!(M||h.distanceToSquared(A.object.position)>w||8*(1-d.dot(A.object.quaternion))>w)&&(A.dispatchEvent(f),h.copy(A.object.position),d.copy(A.object.quaternion),M=!1,!0)}),this.dispose=function(){A.domElement.removeEventListener("contextmenu",ae,!1),A.domElement.removeEventListener("pointerdown",J,!1),A.domElement.removeEventListener("wheel",te,!1),A.domElement.removeEventListener("touchstart",ne,!1),A.domElement.removeEventListener("touchend",se,!1),A.domElement.removeEventListener("touchmove",re,!1),A.domElement.ownerDocument.removeEventListener("pointermove",$,!1),A.domElement.ownerDocument.removeEventListener("pointerup",ee,!1),A.domElement.removeEventListener("keydown",ie,!1)};var A=this,f={type:"change"},m={type:"start"},g={type:"end"},v={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},y=v.NONE,w=1e-6,b=new r,E=new r,x=1,S=new e,M=!1,_=new s,T=new s,R=new s,P=new s,F=new s,C=new s,I=new s,L=new s,D=new s;function O(){return Math.pow(.95,A.zoomSpeed)}function B(e){E.theta-=e}function N(e){E.phi-=e}var k,G=(k=new e,function(e,t){k.setFromMatrixColumn(t,0),k.multiplyScalar(-e),S.add(k)}),U=function(){var t=new e;return function(e,i){!0===A.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(A.object.up,t)),t.multiplyScalar(e),S.add(t)}}(),H=function(){var t=new e;return function(e,i){var n=A.domElement;if(A.object.isPerspectiveCamera){var r=A.object.position;t.copy(r).sub(A.target);var s=t.length();s*=Math.tan(A.object.fov/2*Math.PI/180),G(2*e*s/n.clientHeight,A.object.matrix),U(2*i*s/n.clientHeight,A.object.matrix)}else A.object.isOrthographicCamera?(G(e*(A.object.right-A.object.left)/A.object.zoom/n.clientWidth,A.object.matrix),U(i*(A.object.top-A.object.bottom)/A.object.zoom/n.clientHeight,A.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),A.enablePan=!1)}}();function V(e){A.object.isPerspectiveCamera?x/=e:A.object.isOrthographicCamera?(A.object.zoom=Math.max(A.minZoom,Math.min(A.maxZoom,A.object.zoom*e)),A.object.updateProjectionMatrix(),M=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),A.enableZoom=!1)}function z(e){A.object.isPerspectiveCamera?x*=e:A.object.isOrthographicCamera?(A.object.zoom=Math.max(A.minZoom,Math.min(A.maxZoom,A.object.zoom/e)),A.object.updateProjectionMatrix(),M=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),A.enableZoom=!1)}function Q(e){_.set(e.clientX,e.clientY)}function j(e){P.set(e.clientX,e.clientY)}function X(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(t,i)}}function W(e){if(1==e.touches.length)P.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);P.set(t,i)}}function Y(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);I.set(0,n)}function q(e){if(1==e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(t,i)}R.subVectors(T,_).multiplyScalar(A.rotateSpeed);var n=A.domElement;B(2*Math.PI*R.x/n.clientHeight),N(2*Math.PI*R.y/n.clientHeight),_.copy(T)}function Z(e){if(1==e.touches.length)F.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);F.set(t,i)}C.subVectors(F,P).multiplyScalar(A.panSpeed),H(C.x,C.y),P.copy(F)}function K(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);L.set(0,n),D.set(0,Math.pow(L.y/I.y,A.zoomSpeed)),V(D.y),I.copy(L)}function J(e){if(!1!==A.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var i;switch(e.preventDefault(),A.domElement.focus?A.domElement.focus():window.focus(),e.button){case 0:i=A.mouseButtons.LEFT;break;case 1:i=A.mouseButtons.MIDDLE;break;case 2:i=A.mouseButtons.RIGHT;break;default:i=-1}switch(i){case t.DOLLY:if(!1===A.enableZoom)return;!function(e){I.set(e.clientX,e.clientY)}(e),y=v.DOLLY;break;case t.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===A.enablePan)return;j(e),y=v.PAN}else{if(!1===A.enableRotate)return;Q(e),y=v.ROTATE}break;case t.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===A.enableRotate)return;Q(e),y=v.ROTATE}else{if(!1===A.enablePan)return;j(e),y=v.PAN}break;default:y=v.NONE}y!==v.NONE&&(A.domElement.ownerDocument.addEventListener("pointermove",$,!1),A.domElement.ownerDocument.addEventListener("pointerup",ee,!1),A.dispatchEvent(m))}(e)}}function $(e){if(!1!==A.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===A.enabled)return;switch(e.preventDefault(),y){case v.ROTATE:if(!1===A.enableRotate)return;!function(e){T.set(e.clientX,e.clientY),R.subVectors(T,_).multiplyScalar(A.rotateSpeed);var t=A.domElement;B(2*Math.PI*R.x/t.clientHeight),N(2*Math.PI*R.y/t.clientHeight),_.copy(T),A.update()}(e);break;case v.DOLLY:if(!1===A.enableZoom)return;!function(e){L.set(e.clientX,e.clientY),D.subVectors(L,I),D.y>0?V(O()):D.y<0&&z(O()),I.copy(L),A.update()}(e);break;case v.PAN:if(!1===A.enablePan)return;!function(e){F.set(e.clientX,e.clientY),C.subVectors(F,P).multiplyScalar(A.panSpeed),H(C.x,C.y),P.copy(F),A.update()}(e)}}(e)}}function ee(e){if(!1!==A.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===A.enabled)return;A.domElement.ownerDocument.removeEventListener("pointermove",$,!1),A.domElement.ownerDocument.removeEventListener("pointerup",ee,!1),A.dispatchEvent(g),y=v.NONE}()}}function te(e){!1===A.enabled||!1===A.enableZoom||y!==v.NONE&&y!==v.ROTATE||(e.preventDefault(),e.stopPropagation(),A.dispatchEvent(m),function(e){e.deltaY<0?z(O()):e.deltaY>0&&V(O()),A.update()}(e),A.dispatchEvent(g))}function ie(e){!1!==A.enabled&&!1!==A.enableKeys&&!1!==A.enablePan&&function(e){var t=!1;switch(e.keyCode){case A.keys.UP:H(0,A.keyPanSpeed),t=!0;break;case A.keys.BOTTOM:H(0,-A.keyPanSpeed),t=!0;break;case A.keys.LEFT:H(A.keyPanSpeed,0),t=!0;break;case A.keys.RIGHT:H(-A.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),A.update())}(e)}function ne(e){if(!1!==A.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(A.touches.ONE){case i.ROTATE:if(!1===A.enableRotate)return;X(e),y=v.TOUCH_ROTATE;break;case i.PAN:if(!1===A.enablePan)return;W(e),y=v.TOUCH_PAN;break;default:y=v.NONE}break;case 2:switch(A.touches.TWO){case i.DOLLY_PAN:if(!1===A.enableZoom&&!1===A.enablePan)return;!function(e){A.enableZoom&&Y(e),A.enablePan&&W(e)}(e),y=v.TOUCH_DOLLY_PAN;break;case i.DOLLY_ROTATE:if(!1===A.enableZoom&&!1===A.enableRotate)return;!function(e){A.enableZoom&&Y(e),A.enableRotate&&X(e)}(e),y=v.TOUCH_DOLLY_ROTATE;break;default:y=v.NONE}break;default:y=v.NONE}y!==v.NONE&&A.dispatchEvent(m)}}function re(e){if(!1!==A.enabled)switch(e.preventDefault(),e.stopPropagation(),y){case v.TOUCH_ROTATE:if(!1===A.enableRotate)return;q(e),A.update();break;case v.TOUCH_PAN:if(!1===A.enablePan)return;Z(e),A.update();break;case v.TOUCH_DOLLY_PAN:if(!1===A.enableZoom&&!1===A.enablePan)return;!function(e){A.enableZoom&&K(e),A.enablePan&&Z(e)}(e),A.update();break;case v.TOUCH_DOLLY_ROTATE:if(!1===A.enableZoom&&!1===A.enableRotate)return;!function(e){A.enableZoom&&K(e),A.enableRotate&&q(e)}(e),A.update();break;default:y=v.NONE}}function se(e){!1!==A.enabled&&(A.dispatchEvent(g),y=v.NONE)}function ae(e){!1!==A.enabled&&e.preventDefault()}A.domElement.addEventListener("contextmenu",ae,!1),A.domElement.addEventListener("pointerdown",J,!1),A.domElement.addEventListener("wheel",te,!1),A.domElement.addEventListener("touchstart",ne,!1),A.domElement.addEventListener("touchend",se,!1),A.domElement.addEventListener("touchmove",re,!1),A.domElement.addEventListener("keydown",ie,!1),-1===A.domElement.tabIndex&&(A.domElement.tabIndex=0),this.update()};(Pe.prototype=Object.create(a.prototype)).constructor=Pe;var Fe=function(e,n){Pe.call(this,e,n),this.screenSpacePanning=!1,this.mouseButtons.LEFT=t.PAN,this.mouseButtons.RIGHT=t.ROTATE,this.touches.ONE=i.PAN,this.touches.TWO=i.DOLLY_ROTATE};(Fe.prototype=Object.create(a.prototype)).constructor=Fe;
/**
 * @license
 * webxr-polyfill
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * webvr-polyfill-dpdb 
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * wglu-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
/**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
const Ce="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Ie=Symbol("@@webxr-polyfill/EventTarget");class Le{constructor(){this[Ie]={listeners:new Map}}addEventListener(e,t){if("string"!=typeof e)throw new Error("`type` must be a string");if("function"!=typeof t)throw new Error("`listener` must be a function");const i=this[Ie].listeners.get(e)||[];i.push(t),this[Ie].listeners.set(e,i)}removeEventListener(e,t){if("string"!=typeof e)throw new Error("`type` must be a string");if("function"!=typeof t)throw new Error("`listener` must be a function");const i=this[Ie].listeners.get(e)||[];for(let e=i.length;e>=0;e--)i[e]===t&&i.pop()}dispatchEvent(e,t){const i=this[Ie].listeners.get(e)||[],n=[];for(let e=0;e<i.length;e++)n[e]=i[e];for(let e of n)e(t);"function"==typeof this["on"+e]&&this["on"+e](t)}}let De="undefined"!=typeof Float32Array?Float32Array:Array;function Oe(){let e=new De(16);return De!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Be(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ne(e,t){let i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],A=t[12],f=t[13],m=t[14],g=t[15],v=i*o-n*a,y=i*l-r*a,w=i*c-s*a,b=n*l-r*o,E=n*c-s*o,x=r*c-s*l,S=u*f-h*A,M=u*m-d*A,_=u*g-p*A,T=h*m-d*f,R=h*g-p*f,P=d*g-p*m,F=v*P-y*R+w*T+b*_-E*M+x*S;return F?(F=1/F,e[0]=(o*P-l*R+c*T)*F,e[1]=(r*R-n*P-s*T)*F,e[2]=(f*x-m*E+g*b)*F,e[3]=(d*E-h*x-p*b)*F,e[4]=(l*_-a*P-c*M)*F,e[5]=(i*P-r*_+s*M)*F,e[6]=(m*w-A*x-g*y)*F,e[7]=(u*x-d*w+p*y)*F,e[8]=(a*R-o*_+c*S)*F,e[9]=(n*_-i*R-s*S)*F,e[10]=(A*E-f*w+g*v)*F,e[11]=(h*w-u*E-p*v)*F,e[12]=(o*M-a*T-l*S)*F,e[13]=(i*T-n*M+r*S)*F,e[14]=(f*y-A*b-m*v)*F,e[15]=(u*b-h*y+d*v)*F,e):null}function ke(e,t,i){let n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],A=t[11],f=t[12],m=t[13],g=t[14],v=t[15],y=i[0],w=i[1],b=i[2],E=i[3];return e[0]=y*n+w*o+b*h+E*f,e[1]=y*r+w*l+b*d+E*m,e[2]=y*s+w*c+b*p+E*g,e[3]=y*a+w*u+b*A+E*v,y=i[4],w=i[5],b=i[6],E=i[7],e[4]=y*n+w*o+b*h+E*f,e[5]=y*r+w*l+b*d+E*m,e[6]=y*s+w*c+b*p+E*g,e[7]=y*a+w*u+b*A+E*v,y=i[8],w=i[9],b=i[10],E=i[11],e[8]=y*n+w*o+b*h+E*f,e[9]=y*r+w*l+b*d+E*m,e[10]=y*s+w*c+b*p+E*g,e[11]=y*a+w*u+b*A+E*v,y=i[12],w=i[13],b=i[14],E=i[15],e[12]=y*n+w*o+b*h+E*f,e[13]=y*r+w*l+b*d+E*m,e[14]=y*s+w*c+b*p+E*g,e[15]=y*a+w*u+b*A+E*v,e}function Ge(e,t,i){let n=t[0],r=t[1],s=t[2],a=t[3],o=n+n,l=r+r,c=s+s,u=n*o,h=n*l,d=n*c,p=r*l,A=r*c,f=s*c,m=a*o,g=a*l,v=a*c;return e[0]=1-(p+f),e[1]=h+v,e[2]=d-g,e[3]=0,e[4]=h-v,e[5]=1-(u+f),e[6]=A+m,e[7]=0,e[8]=d+g,e[9]=A-m,e[10]=1-(u+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Ue(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function He(e,t){let i=t[0]+t[5]+t[10],n=0;return i>0?(n=2*Math.sqrt(i+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e}function Ve(e,t,i,n,r){let s,a=1/Math.tan(t/2);return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(s=1/(n-r),e[10]=(r+n)*s,e[14]=2*r*n*s):(e[10]=-1,e[14]=-2*n),e}function ze(){let e=new De(3);return De!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Qe(e){var t=new De(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function je(e,t,i){let n=new De(3);return n[0]=e,n[1]=t,n[2]=i,n}function Xe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function We(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function Ye(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function qe(e,t){let i=t[0],n=t[1],r=t[2],s=i*i+n*n+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function Ze(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ke(e,t,i){let n=t[0],r=t[1],s=t[2],a=i[0],o=i[1],l=i[2];return e[0]=r*l-s*o,e[1]=s*a-n*l,e[2]=n*o-r*a,e}function Je(e,t,i){let n=i[0],r=i[1],s=i[2],a=i[3],o=t[0],l=t[1],c=t[2],u=r*c-s*l,h=s*o-n*c,d=n*l-r*o,p=r*d-s*h,A=s*u-n*d,f=n*h-r*u,m=2*a;return u*=m,h*=m,d*=m,p*=2,A*=2,f*=2,e[0]=o+u+p,e[1]=l+h+A,e[2]=c+d+f,e}const $e=function(e){let t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)};!function(){let e=ze()}();!function(){let e=function(){let e=new De(4);return De!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function et(){let e=new De(4);return De!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function tt(e,t,i){let n=t[0],r=t[1],s=t[2],a=t[3],o=i[0],l=i[1],c=i[2],u=i[3];return e[0]=n*u+a*o+r*c-s*l,e[1]=r*u+a*l+s*o-n*c,e[2]=s*u+a*c+n*l-r*o,e[3]=a*u-n*o-r*l-s*c,e}function it(e,t,i,n){let r,s,a,o,l,c=t[0],u=t[1],h=t[2],d=t[3],p=i[0],A=i[1],f=i[2],m=i[3];return s=c*p+u*A+h*f+d*m,s<0&&(s=-s,p=-p,A=-A,f=-f,m=-m),1-s>1e-6?(r=Math.acos(s),a=Math.sin(r),o=Math.sin((1-n)*r)/a,l=Math.sin(n*r)/a):(o=1-n,l=n),e[0]=o*c+l*p,e[1]=o*u+l*A,e[2]=o*h+l*f,e[3]=o*d+l*m,e}function nt(e,t){let i=t[0],n=t[1],r=t[2],s=t[3],a=i*i+n*n+r*r+s*s,o=a?1/a:0;return e[0]=-i*o,e[1]=-n*o,e[2]=-r*o,e[3]=s*o,e}const rt=function(e){let t=new De(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},st=function(e,t,i,n){let r=new De(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r},at=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ot=function(e,t){let i=t[0],n=t[1],r=t[2],s=t[3],a=i*i+n*n+r*r+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=i*a,e[1]=n*a,e[2]=r*a,e[3]=s*a),e},lt=(function(){let e=ze(),t=je(1,0,0),i=je(0,1,0)}(),function(){let e=et(),t=et()}(),function(){let e=function(){let e=new De(9);return De!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}(),Symbol("@@webxr-polyfill/XRRigidTransform"));class ct{constructor(){if(this[lt]={matrix:null,position:null,orientation:null,inverse:null},0===arguments.length)this[lt].matrix=Be(new Float32Array(16));else if(1===arguments.length)arguments[0]instanceof Float32Array?this[lt].matrix=arguments[0]:(this[lt].position=this._getPoint(arguments[0]),this[lt].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else{if(2!==arguments.length)throw new Error("Too many arguments!");this[lt].position=this._getPoint(arguments[0]),this[lt].orientation=this._getPoint(arguments[1])}if(this[lt].matrix){let e=ze();Ue(e,this[lt].matrix),this[lt].position=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2]});let t=et();He(t,this[lt].matrix),this[lt].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else this[lt].matrix=Be(new Float32Array(16)),Ge(this[lt].matrix,st(this[lt].orientation.x,this[lt].orientation.y,this[lt].orientation.z,this[lt].orientation.w),je(this[lt].position.x,this[lt].position.y,this[lt].position.z))}_getPoint(e){return e instanceof DOMPointReadOnly?e:DOMPointReadOnly.fromPoint(e)}get matrix(){return this[lt].matrix}get position(){return this[lt].position}get orientation(){return this[lt].orientation}get inverse(){if(null===this[lt].inverse){let e=Be(new Float32Array(16));Ne(e,this[lt].matrix),this[lt].inverse=new ct(e),this[lt].inverse[lt].inverse=this}return this[lt].inverse}}const ut=Symbol("@@webxr-polyfill/XRSpace");class ht{constructor(e=null,t=null){this[ut]={specialType:e,inputSource:t,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[ut].specialType}get _inputSource(){return this[ut].inputSource}_ensurePoseUpdated(e,t){t!=this[ut].lastFrameId&&(this[ut].lastFrameId=t,this._onPoseUpdate(e))}_onPoseUpdate(e){"viewer"==this[ut].specialType&&(this._baseMatrix=e.getBasePoseMatrix())}set _baseMatrix(e){this[ut].baseMatrix=e,this[ut].inverseBaseMatrix=null}get _baseMatrix(){return this[ut].baseMatrix||this[ut].inverseBaseMatrix&&(this[ut].baseMatrix=new Float32Array(16),Ne(this[ut].baseMatrix,this[ut].inverseBaseMatrix)),this[ut].baseMatrix}set _inverseBaseMatrix(e){this[ut].inverseBaseMatrix=e,this[ut].baseMatrix=null}get _inverseBaseMatrix(){return this[ut].inverseBaseMatrix||this[ut].baseMatrix&&(this[ut].inverseBaseMatrix=new Float32Array(16),Ne(this[ut].inverseBaseMatrix,this[ut].baseMatrix)),this[ut].inverseBaseMatrix}_getSpaceRelativeTransform(e){if(!this._inverseBaseMatrix||!e._baseMatrix)return null;let t=new Float32Array(16);return ke(t,this._inverseBaseMatrix,e._baseMatrix),new ct(t)}}const dt=Symbol("@@webxr-polyfill/XRReferenceSpace"),pt=["viewer","local","local-floor","bounded-floor","unbounded"];class At extends ht{constructor(e,t=null){if(!pt.includes(e))throw new Error("XRReferenceSpaceType must be one of "+pt);if(super(e),"bounded-floor"===e&&!t)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");(function(e){return"bounded-floor"===e||"local-floor"===e})(e)&&!t&&((t=Be(new Float32Array(16)))[13]=1.6),this._inverseBaseMatrix=t||Be(new Float32Array(16)),this[dt]={type:e,transform:t,originOffset:Be(new Float32Array(16))}}_transformBasePoseMatrix(e,t){ke(e,this._inverseBaseMatrix,t)}_originOffsetMatrix(){return this[dt].originOffset}_adjustForOriginOffset(e){let t=new Float32Array(16);Ne(t,this[dt].originOffset),ke(e,t,e)}_getSpaceRelativeTransform(e){let t=super._getSpaceRelativeTransform(e);return this._adjustForOriginOffset(t.matrix),new XRRigidTransform(t.matrix)}getOffsetReferenceSpace(e){let t=new At(this[dt].type,this[dt].transform,this[dt].bounds);return ke(t[dt].originOffset,this[dt].originOffset,e.matrix),t}}const ft=Symbol("@@webxr-polyfill/XR"),mt=["inline","immersive-vr","immersive-ar"],gt={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}};let vt;if("performance"in Ce==!1){let e=Date.now();vt=()=>Date.now()-e}else vt=()=>performance.now();var yt=vt;const wt=Symbol("@@webxr-polyfill/XRPose");class bt{constructor(e,t){this[wt]={transform:e,emulatedPosition:t}}get transform(){return this[wt].transform}get emulatedPosition(){return this[wt].emulatedPosition}}const Et=Symbol("@@webxr-polyfill/XRViewerPose");class xt extends bt{constructor(e,t,i=!1){super(e,i),this[Et]={views:t}}get views(){return this[Et].views}}const St=Symbol("@@webxr-polyfill/XRViewport");class Mt{constructor(e){this[St]={target:e}}get x(){return this[St].target.x}get y(){return this[St].target.y}get width(){return this[St].target.width}get height(){return this[St].target.height}}const _t=["left","right","none"],Tt=Symbol("@@webxr-polyfill/XRView");class Rt{constructor(e,t,i,n){if(!_t.includes(i))throw new Error("XREye must be one of: "+_t);const r=Object.create(null),s=new Mt(r);this[Tt]={device:e,eye:i,viewport:s,temp:r,sessionId:n,transform:t}}get eye(){return this[Tt].eye}get projectionMatrix(){return this[Tt].device.getProjectionMatrix(this.eye)}get transform(){return this[Tt].transform}_getViewport(e){if(this[Tt].device.getViewport(this[Tt].sessionId,this.eye,e,this[Tt].temp))return this[Tt].viewport}}const Pt=Symbol("@@webxr-polyfill/XRFrame"),Ft="XRFrame access outside the callback that produced it is invalid.";let Ct=0;class It{constructor(e,t,i){this[Pt]={id:++Ct,active:!1,animationFrame:!1,device:e,session:t,sessionId:i}}get session(){return this[Pt].session}getViewerPose(e){if(!this[Pt].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[Pt].active)throw new DOMException(Ft,"InvalidStateError");const t=this[Pt].device,i=this[Pt].session;i[Xt].viewerSpace._ensurePoseUpdated(t,this[Pt].id),e._ensurePoseUpdated(t,this[Pt].id);let n=e._getSpaceRelativeTransform(i[Xt].viewerSpace);const r=[];for(let n of i[Xt].viewSpaces){n._ensurePoseUpdated(t,this[Pt].id);let i=e._getSpaceRelativeTransform(n),s=new Rt(t,i,n.eye,this[Pt].sessionId);r.push(s)}return new xt(n,r,!1)}getPose(e,t){if(!this[Pt].active)throw new DOMException(Ft,"InvalidStateError");const i=this[Pt].device;if("target-ray"===e._specialType||"grip"===e._specialType)return i.getInputPose(e._inputSource,t,e._specialType);{e._ensurePoseUpdated(i,this[Pt].id),t._ensurePoseUpdated(i,this[Pt].id);let n=t._getSpaceRelativeTransform(e);return n?new XRPose(n,!1):null}}}const Lt=Symbol("@@webxr-polyfill/XRRenderState"),Dt=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null});class Ot{constructor(e={}){const t=Object.assign({},Dt,e);this[Lt]={config:t}}get depthNear(){return this[Lt].config.depthNear}get depthFar(){return this[Lt].config.depthFar}get inlineVerticalFieldOfView(){return this[Lt].config.inlineVerticalFieldOfView}get baseLayer(){return this[Lt].config.baseLayer}}const Bt=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Nt=Symbol("@@webxr-polyfill/xr-compatible"),kt=Symbol("@@webxr-polyfill/XRWebGLLayer"),Gt=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1});const Ut=Symbol("@@webxr-polyfill/XRInputSourceEvent");class Ht extends Event{constructor(e,t){super(e,t),this[Ut]={frame:t.frame,inputSource:t.inputSource},Object.setPrototypeOf(this,Ht.prototype)}get frame(){return this[Ut].frame}get inputSource(){return this[Ut].inputSource}}const Vt=Symbol("@@webxr-polyfill/XRSessionEvent");class zt extends Event{constructor(e,t){super(e,t),this[Vt]={session:t.session},Object.setPrototypeOf(this,zt.prototype)}get session(){return this[Vt].session}}const Qt=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent");class jt extends Event{constructor(e,t){super(e,t),this[Qt]={session:t.session,added:t.added,removed:t.removed},Object.setPrototypeOf(this,jt.prototype)}get session(){return this[Qt].session}get added(){return this[Qt].added}get removed(){return this[Qt].removed}}const Xt=Symbol("@@webxr-polyfill/XRSession");class Wt extends ht{constructor(e){super(e)}get eye(){return this._specialType}_onPoseUpdate(e){this._inverseBaseMatrix=e.getBaseViewMatrix(this._specialType)}}class Yt extends Le{constructor(e,t,i){super();let n="inline"!=t,r=new Ot({inlineVerticalFieldOfView:n?null:.5*Math.PI});this[Xt]={device:e,mode:t,immersive:n,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:i,activeRenderState:r,pendingRenderState:null,viewerSpace:new At("viewer"),viewSpaces:[],currentInputSources:[]},n?this[Xt].viewSpaces.push(new Wt("left"),new Wt("right")):this[Xt].viewSpaces.push(new Wt("none")),this[Xt].onDeviceFrame=()=>{if(this[Xt].ended||this[Xt].suspended)return;if(this[Xt].deviceFrameHandle=null,this[Xt].startDeviceFrameLoop(),null!==this[Xt].pendingRenderState&&(this[Xt].activeRenderState=new Ot(this[Xt].pendingRenderState),this[Xt].pendingRenderState=null,this[Xt].activeRenderState.baseLayer&&this[Xt].device.onBaseLayerSet(this[Xt].id,this[Xt].activeRenderState.baseLayer)),null===this[Xt].activeRenderState.baseLayer)return;const t=new It(e,this,this[Xt].id),i=this[Xt].currentFrameCallbacks=this[Xt].frameCallbacks;this[Xt].frameCallbacks=[],t[Pt].active=!0,t[Pt].animationFrame=!0,this[Xt].device.onFrameStart(this[Xt].id,this[Xt].activeRenderState),this._checkInputSourcesChange();const n=yt();for(let e=0;e<i.length;e++)try{i[e].cancelled||"function"!=typeof i[e].callback||i[e].callback(n,t)}catch(e){console.error(e)}this[Xt].currentFrameCallbacks=null,t[Pt].active=!1,this[Xt].device.onFrameEnd(this[Xt].id)},this[Xt].startDeviceFrameLoop=()=>{null===this[Xt].deviceFrameHandle&&(this[Xt].deviceFrameHandle=this[Xt].device.requestAnimationFrame(this[Xt].onDeviceFrame))},this[Xt].stopDeviceFrameLoop=()=>{const e=this[Xt].deviceFrameHandle;null!==e&&(this[Xt].device.cancelAnimationFrame(e),this[Xt].deviceFrameHandle=null)},this[Xt].onPresentationEnd=t=>{if(t!==this[Xt].id)return this[Xt].suspended=!1,this[Xt].startDeviceFrameLoop(),void this.dispatchEvent("focus",{session:this});this[Xt].ended=!0,this[Xt].stopDeviceFrameLoop(),e.removeEventListener("@@webxr-polyfill/vr-present-end",this[Xt].onPresentationEnd),e.removeEventListener("@@webxr-polyfill/vr-present-start",this[Xt].onPresentationStart),e.removeEventListener("@@webxr-polyfill/input-select-start",this[Xt].onSelectStart),e.removeEventListener("@@webxr-polyfill/input-select-end",this[Xt].onSelectEnd),this.dispatchEvent("end",new zt("end",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-end",this[Xt].onPresentationEnd),this[Xt].onPresentationStart=e=>{e!==this[Xt].id&&(this[Xt].suspended=!0,this[Xt].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-start",this[Xt].onPresentationStart),this[Xt].onSelectStart=e=>{e.sessionId===this[Xt].id&&this[Xt].dispatchInputSourceEvent("selectstart",e.inputSource)},e.addEventListener("@@webxr-polyfill/input-select-start",this[Xt].onSelectStart),this[Xt].onSelectEnd=e=>{e.sessionId===this[Xt].id&&(this[Xt].dispatchInputSourceEvent("selectend",e.inputSource),this[Xt].dispatchInputSourceEvent("select",e.inputSource))},e.addEventListener("@@webxr-polyfill/input-select-end",this[Xt].onSelectEnd),this[Xt].onSqueezeStart=e=>{e.sessionId===this[Xt].id&&this[Xt].dispatchInputSourceEvent("squeezestart",e.inputSource)},e.addEventListener("@@webxr-polyfill/input-squeeze-start",this[Xt].onSqueezeStart),this[Xt].onSqueezeEnd=e=>{e.sessionId===this[Xt].id&&(this[Xt].dispatchInputSourceEvent("squeezeend",e.inputSource),this[Xt].dispatchInputSourceEvent("squeeze",e.inputSource))},e.addEventListener("@@webxr-polyfill/input-squeeze-end",this[Xt].onSqueezeEnd),this[Xt].dispatchInputSourceEvent=(t,i)=>{const n=new It(e,this,this[Xt].id),r=new Ht(t,{frame:n,inputSource:i});n[Pt].active=!0,this.dispatchEvent(t,r),n[Pt].active=!1},this[Xt].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[Xt].activeRenderState}get environmentBlendMode(){return this[Xt].device.environmentBlendMode||"opaque"}async requestReferenceSpace(e){if(this[Xt].ended)return;if(!pt.includes(e))throw new TypeError("XRReferenceSpaceType must be one of "+pt);if(!this[Xt].device.doesSessionSupportReferenceSpace(this[Xt].id,e))throw new DOMException(`The ${e} reference space is not supported by this session.`,"NotSupportedError");if("viewer"===e)return this[Xt].viewerSpace;let t=await this[Xt].device.requestFrameOfReferenceTransform(e);if("bounded-floor"===e){if(!t)throw new DOMException(e+" XRReferenceSpace not supported by this device.","NotSupportedError");if(!this[Xt].device.requestStageBounds())throw new DOMException(e+" XRReferenceSpace not supported by this device.","NotSupportedError");throw new DOMException(`The WebXR polyfill does not support the ${e} reference space yet.`,"NotSupportedError")}return new At(e,t)}requestAnimationFrame(e){if(this[Xt].ended)return;const t=++this[Xt].frameHandle;return this[Xt].frameCallbacks.push({handle:t,callback:e,cancelled:!1}),t}cancelAnimationFrame(e){let t=this[Xt].frameCallbacks,i=t.findIndex((t=>t&&t.handle===e));i>-1&&(t[i].cancelled=!0,t.splice(i,1)),t=this[Xt].currentFrameCallbacks,t&&(i=t.findIndex((t=>t&&t.handle===e)),i>-1&&(t[i].cancelled=!0))}get inputSources(){return this[Xt].device.getInputSources()}async end(){if(!this[Xt].ended)return this[Xt].immersive&&(this[Xt].ended=!0,this[Xt].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[Xt].onPresentationStart),this[Xt].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[Xt].onPresentationEnd),this[Xt].device.removeEventListener("@@webxr-polyfill/input-select-start",this[Xt].onSelectStart),this[Xt].device.removeEventListener("@@webxr-polyfill/input-select-end",this[Xt].onSelectEnd),this.dispatchEvent("end",new zt("end",{session:this}))),this[Xt].stopDeviceFrameLoop(),this[Xt].device.endSession(this[Xt].id)}updateRenderState(e){if(this[Xt].ended){throw new Error("Can't call updateRenderState on an XRSession that has already ended.")}if(e.baseLayer&&e.baseLayer._session!==this){throw new Error("Called updateRenderState with a base layer that was created by a different session.")}if(null!==e.inlineVerticalFieldOfView&&void 0!==e.inlineVerticalFieldOfView){if(this[Xt].immersive){throw new Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.")}e.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,e.inlineVerticalFieldOfView))}if(null===this[Xt].pendingRenderState){const e=this[Xt].activeRenderState;this[Xt].pendingRenderState={depthNear:e.depthNear,depthFar:e.depthFar,inlineVerticalFieldOfView:e.inlineVerticalFieldOfView,baseLayer:e.baseLayer}}Object.assign(this[Xt].pendingRenderState,e)}_checkInputSourcesChange(){const e=[],t=[],i=this.inputSources,n=this[Xt].currentInputSources;for(const t of i)n.includes(t)||e.push(t);for(const e of n)i.includes(e)||t.push(e);(e.length>0||t.length>0)&&this.dispatchEvent("inputsourceschange",new jt("inputsourceschange",{session:this,added:e,removed:t})),this[Xt].currentInputSources.length=0;for(const e of i)this[Xt].currentInputSources.push(e)}}const qt=Symbol("@@webxr-polyfill/XRInputSource");class Zt{constructor(e){this[qt]={impl:e,gripSpace:new ht("grip",this),targetRaySpace:new ht("target-ray",this)}}get handedness(){return this[qt].impl.handedness}get targetRayMode(){return this[qt].impl.targetRayMode}get gripSpace(){let e=this[qt].impl.targetRayMode;return"gaze"===e||"screen"===e?null:this[qt].gripSpace}get targetRaySpace(){return this[qt].targetRaySpace}get profiles(){return this[qt].impl.profiles}get gamepad(){return this[qt].impl.gamepad}}const Kt=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent");class Jt extends Event{constructor(e,t){super(e,t),this[Kt]={referenceSpace:t.referenceSpace,transform:t.transform||null},Object.setPrototypeOf(this,Jt.prototype)}get referenceSpace(){return this[Kt].referenceSpace}get transform(){return this[Kt].transform}}var $t={XRSystem:class extends Le{constructor(e){super(),this[ft]={device:null,devicePromise:e,immersiveSession:null,inlineSessions:new Set},e.then((e=>{this[ft].device=e}))}async isSessionSupported(e){return this[ft].device||await this[ft].devicePromise,"inline"!=e?Promise.resolve(this[ft].device.isSessionSupported(e)):Promise.resolve(!0)}async requestSession(e,t){if(!this[ft].device){if("inline"!=e)throw new Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");await this[ft].devicePromise}if(!mt.includes(e))throw new TypeError(`The provided value '${e}' is not a valid enum value of type XRSessionMode`);const i=gt[e],n=i.requiredFeatures.concat(t&&t.requiredFeatures?t.requiredFeatures:[]),r=i.optionalFeatures.concat(t&&t.optionalFeatures?t.optionalFeatures:[]),s=new Set;let a=!1;for(let e of n)this[ft].device.isFeatureSupported(e)?s.add(e):(console.error(`The required feature '${e}' is not supported`),a=!0);if(a)throw new DOMException("Session does not support some required features","NotSupportedError");for(let e of r)this[ft].device.isFeatureSupported(e)?s.add(e):console.log(`The optional feature '${e}' is not supported`);const o=await this[ft].device.requestSession(e,s),l=new XRSession(this[ft].device,e,o);"inline"==e?this[ft].inlineSessions.add(l):this[ft].immersiveSession=l;const c=()=>{"inline"==e?this[ft].inlineSessions.delete(l):this[ft].immersiveSession=null,l.removeEventListener("end",c)};return l.addEventListener("end",c),l}},XRSession:Yt,XRSessionEvent:zt,XRFrame:It,XRView:Rt,XRViewport:Mt,XRViewerPose:xt,XRWebGLLayer:class{constructor(e,t,i={}){const n=Object.assign({},Gt,i);if(!(e instanceof Yt))throw new Error("session must be a XRSession");if(e.ended)throw new Error("InvalidStateError");if(t[Bt]&&!0!==t[Nt])throw new Error("InvalidStateError");const r=t.getParameter(t.FRAMEBUFFER_BINDING);this[kt]={context:t,config:n,framebuffer:r,session:e}}get context(){return this[kt].context}get antialias(){return this[kt].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[kt].framebuffer}get framebufferWidth(){return this[kt].context.drawingBufferWidth}get framebufferHeight(){return this[kt].context.drawingBufferHeight}get _session(){return this[kt].session}getViewport(e){return e._getViewport(this)}static getNativeFramebufferScaleFactor(e){if(!e)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return e[Xt].ended?0:1}},XRSpace:ht,XRReferenceSpace:At,XRReferenceSpaceEvent:Jt,XRInputSource:Zt,XRInputSourceEvent:Ht,XRInputSourcesChangeEvent:jt,XRRenderState:Ot,XRRigidTransform:ct,XRPose:bt};const ei=e=>"function"!=typeof e.prototype.makeXRCompatible&&(e.prototype.makeXRCompatible=function(){return this[Nt]=!0,Promise.resolve()},!0),ti=e=>{const t=e.prototype.getContext;e.prototype.getContext=function(e,i){const n=t.call(this,e,i);return n&&(n[Bt]=!0,i&&"xrCompatible"in i&&(n[Nt]=i.xrCompatible)),n}};var ii="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var ni,ri,si=(function(e,t){e.exports=function(){var e,t,i,n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(){function e(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){r=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw s}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=.001,o=1,l=function(e,t){return"data:"+e+","+encodeURIComponent(t)},c=function(e,t,i){return e+(t-e)*i},u=function(){var e=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return e}}(),h=function(){var e=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return e}}(),d=function(){var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return e}}(),p=function(){var e=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return e}}(),A=(t=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),i=t?parseInt(t[1],10):null,function(){return i}),f=function(){var e=!1;return e=u()&&d()&&-1!==navigator.userAgent.indexOf("13_4"),function(){return e}}(),m=function(){var e=!1;if(65===A()){var t=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(t){var i=t[1].split("."),n=s(i,4),r=(n[0],n[1],n[2]),a=n[3];e=3325===parseInt(r,10)&&parseInt(a,10)<148}}return function(){return e}}(),g=function(){var e=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return e}}(),v=function(){var e=90==window.orientation||-90==window.orientation;return g()?!e:e},y=function(e){return!(isNaN(e)||e<=a||e>o)},w=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},b=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},E=function(e){if(h())return!1;if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else{if(!e.msRequestFullscreen)return!1;e.msRequestFullscreen()}return!0},x=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},S=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},M=function(e,t,i,n){var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t),e.compileShader(r);var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,i),e.compileShader(s);var a=e.createProgram();for(var o in e.attachShader(a,r),e.attachShader(a,s),n)e.bindAttribLocation(a,n[o],o);return e.linkProgram(a),e.deleteShader(r),e.deleteShader(s),a},_=function(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r="",s=0;s<n;s++)i[r=e.getActiveUniform(t,s).name.replace("[0]","")]=e.getUniformLocation(t,r);return i},T=function(e,t,i,n,r,s,a){var o=1/(t-i),l=1/(n-r),c=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*o,e[13]=(r+n)*l,e[14]=(a+s)*c,e[15]=1,e},R=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},P=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},F=function(e){if(u()){var t=e.style.width,i=e.style.height;e.style.width=parseInt(t)+1+"px",e.style.height=parseInt(i)+"px",setTimeout((function(){e.style.width=t,e.style.height=i}),100)}window.canvas=e},C=function(){var e=Math.PI/180,t=.25*Math.PI;function i(i,n,r,s){var a=Math.tan(n?n.upDegrees*e:t),o=Math.tan(n?n.downDegrees*e:t),l=Math.tan(n?n.leftDegrees*e:t),c=Math.tan(n?n.rightDegrees*e:t),u=2/(l+c),h=2/(a+o);return i[0]=u,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=h,i[6]=0,i[7]=0,i[8]=-(l-c)*u*.5,i[9]=(a-o)*h*.5,i[10]=s/(r-s),i[11]=-1,i[12]=0,i[13]=0,i[14]=s*r/(r-s),i[15]=0,i}function n(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=n+n,l=r+r,c=s+s,u=n*o,h=n*l,d=n*c,p=r*l,A=r*c,f=s*c,m=a*o,g=a*l,v=a*c;return e[0]=1-(p+f),e[1]=h+v,e[2]=d-g,e[3]=0,e[4]=h-v,e[5]=1-(u+f),e[6]=A+m,e[7]=0,e[8]=d+g,e[9]=A-m,e[10]=1-(u+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function r(e,t,i){var n,r,s,a,o,l,c,u,h,d,p,A,f=i[0],m=i[1],g=i[2];return t===e?(e[12]=t[0]*f+t[4]*m+t[8]*g+t[12],e[13]=t[1]*f+t[5]*m+t[9]*g+t[13],e[14]=t[2]*f+t[6]*m+t[10]*g+t[14],e[15]=t[3]*f+t[7]*m+t[11]*g+t[15]):(n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],A=t[11],e[0]=n,e[1]=r,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=A,e[12]=n*f+o*m+h*g+t[12],e[13]=r*f+l*m+d*g+t[13],e[14]=s*f+c*m+p*g+t[14],e[15]=a*f+u*m+A*g+t[15]),e}function s(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],A=t[12],f=t[13],m=t[14],g=t[15],v=i*o-n*a,y=i*l-r*a,w=i*c-s*a,b=n*l-r*o,E=n*c-s*o,x=r*c-s*l,S=u*f-h*A,M=u*m-d*A,_=u*g-p*A,T=h*m-d*f,R=h*g-p*f,P=d*g-p*m,F=v*P-y*R+w*T+b*_-E*M+x*S;return F?(F=1/F,e[0]=(o*P-l*R+c*T)*F,e[1]=(r*R-n*P-s*T)*F,e[2]=(f*x-m*E+g*b)*F,e[3]=(d*E-h*x-p*b)*F,e[4]=(l*_-a*P-c*M)*F,e[5]=(i*P-r*_+s*M)*F,e[6]=(m*w-A*x-g*y)*F,e[7]=(u*x-d*w+p*y)*F,e[8]=(a*R-o*_+c*S)*F,e[9]=(n*_-i*R-s*S)*F,e[10]=(A*E-f*w+g*v)*F,e[11]=(h*w-u*E-p*v)*F,e[12]=(o*M-a*T-l*S)*F,e[13]=(i*T-n*M+r*S)*F,e[14]=(f*y-A*b-m*v)*F,e[15]=(u*b-h*y+d*v)*F,e):null}var a=new Float32Array([0,0,0,1]),o=new Float32Array([0,0,0]);function l(e,t,l,c,u,h){i(e,c||null,h.depthNear,h.depthFar),n(t,l.orientation||a,l.position||o),u&&r(t,t,u),s(t,t)}return function(e,t,i){return!(!e||!t||(e.pose=t,e.timestamp=t.timestamp,l(e.leftProjectionMatrix,e.leftViewMatrix,t,i._getFieldOfView("left"),i._getEyeOffset("left"),i),l(e.rightProjectionMatrix,e.rightViewMatrix,t,i._getFieldOfView("right"),i._getEyeOffset("right"),i),0))}}(),I=function(){var e=window.self!==window.top,t=L(document.referrer),i=L(window.location.href);return e&&t!==i},L=function(e){var t,i=e.indexOf("://");t=-1!==i?i+3:0;var n=e.indexOf("/",t);return-1===n&&(n=e.length),e.substring(0,n)},D=function(e){return e.w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(e.w)},O=(e={},function(t,i){void 0===e[t]&&(console.warn("webvr-polyfill: "+i),e[t]=!0)}),B=function(e,t){O(e,e+" has been deprecated. This may not work on native WebVR displays. "+(t?"Please use "+t+" instead.":""))};function N(e,t,i){if(t){for(var n=[],r=null,s=0;s<t.length;++s)switch(a=t[s]){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),n.push(null,null);break}r||(r=e.getParameter(e.ACTIVE_TEXTURE)),e.activeTexture(l),n.push(e.getParameter(a),null);break;case e.ACTIVE_TEXTURE:r=e.getParameter(e.ACTIVE_TEXTURE),n.push(null);break;default:n.push(e.getParameter(a))}for(i(e),s=0;s<t.length;++s){var a=t[s],o=n[s];switch(a){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,o);break;case e.COLOR_CLEAR_VALUE:e.clearColor(o[0],o[1],o[2],o[3]);break;case e.COLOR_WRITEMASK:e.colorMask(o[0],o[1],o[2],o[3]);break;case e.CURRENT_PROGRAM:e.useProgram(o);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,o);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,o);break;case e.TEXTURE_BINDING_2D:if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_2D,o);break;case e.TEXTURE_BINDING_CUBE_MAP:var l;if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_CUBE_MAP,o);break;case e.VIEWPORT:e.viewport(o[0],o[1],o[2],o[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:o?e.enable(a):e.disable(a);break;default:console.log("No GL restore behavior for 0x"+a.toString(16))}r&&e.activeTexture(r)}}else i(e)}var k=N,G=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),U=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function H(e,t,i,n){this.gl=e,this.cardboardUI=t,this.bufferScale=i,this.dirtySubmitFrameBindings=n,this.ctxAttribs=e.getContextAttributes(),this.instanceExt=e.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,u()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=M(e,G,U,this.attribs),this.uniforms=_(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize()}H.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},H.prototype.onResize=function(){var e=this.gl,t=this,i=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];k(e,i,(function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.framebuffer),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.texImage2D(e.TEXTURE_2D,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,t.bufferWidth,t.bufferHeight,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.renderTarget,0),t.ctxAttribs.depth&&t.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t.depthStencilBuffer)):t.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)):t.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,t.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t.stencilBuffer)),!e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),t.realClearColor.apply(e,t.clearColor)})),this.cardboardUI&&this.cardboardUI.onResize()},H.prototype.patch=function(){if(!this.isPatched){var e=this,t=this.gl.canvas,i=this.gl;u()||(t.width=w()*this.bufferScale,t.height=b()*this.bufferScale,Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:function(){return e.bufferWidth},set:function(i){e.bufferWidth=i,e.realCanvasWidth.set.call(t,i),e.onResize()}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:function(){return e.bufferHeight},set:function(i){e.bufferHeight=i,e.realCanvasHeight.set.call(t,i),e.onResize()}})),this.lastBoundFramebuffer=i.getParameter(i.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(t,n){e.lastBoundFramebuffer=n||e.framebuffer,e.realBindFramebuffer.call(i,t,e.lastBoundFramebuffer)},this.cullFace=i.getParameter(i.CULL_FACE),this.depthTest=i.getParameter(i.DEPTH_TEST),this.blend=i.getParameter(i.BLEND),this.scissorTest=i.getParameter(i.SCISSOR_TEST),this.stencilTest=i.getParameter(i.STENCIL_TEST),i.enable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!0;break;case i.DEPTH_TEST:e.depthTest=!0;break;case i.BLEND:e.blend=!0;break;case i.SCISSOR_TEST:e.scissorTest=!0;break;case i.STENCIL_TEST:e.stencilTest=!0}e.realEnable.call(i,t)},i.disable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!1;break;case i.DEPTH_TEST:e.depthTest=!1;break;case i.BLEND:e.blend=!1;break;case i.SCISSOR_TEST:e.scissorTest=!1;break;case i.STENCIL_TEST:e.stencilTest=!1}e.realDisable.call(i,t)},this.colorMask=i.getParameter(i.COLOR_WRITEMASK),i.colorMask=function(t,n,r,s){e.colorMask[0]=t,e.colorMask[1]=n,e.colorMask[2]=r,e.colorMask[3]=s,e.realColorMask.call(i,t,n,r,s)},this.clearColor=i.getParameter(i.COLOR_CLEAR_VALUE),i.clearColor=function(t,n,r,s){e.clearColor[0]=t,e.clearColor[1]=n,e.clearColor[2]=r,e.clearColor[3]=s,e.realClearColor.call(i,t,n,r,s)},this.viewport=i.getParameter(i.VIEWPORT),i.viewport=function(t,n,r,s){e.viewport[0]=t,e.viewport[1]=n,e.viewport[2]=r,e.viewport[3]=s,e.realViewport.call(i,t,n,r,s)},this.isPatched=!0,F(t)}},H.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,t=this.gl.canvas;u()||(Object.defineProperty(t,"width",this.realCanvasWidth),Object.defineProperty(t,"height",this.realCanvasHeight)),t.width=this.bufferWidth,t.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1,setTimeout((function(){F(t)}),1)}},H.prototype.setTextureBounds=function(e,t){e||(e=[0,0,.5,1]),t||(t=[.5,0,.5,1]),this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=t[0],this.viewportOffsetScale[5]=t[1],this.viewportOffsetScale[6]=t[2],this.viewportOffsetScale[7]=t[3]},H.prototype.submitFrame=function(){var e=this.gl,t=this,i=[];if(this.dirtySubmitFrameBindings||i.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),k(e,i,(function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null);var i=0,n=0;t.instanceExt&&(i=e.getVertexAttrib(t.attribs.position,t.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),n=e.getVertexAttrib(t.attribs.texCoord,t.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),t.cullFace&&t.realDisable.call(e,e.CULL_FACE),t.depthTest&&t.realDisable.call(e,e.DEPTH_TEST),t.blend&&t.realDisable.call(e,e.BLEND),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realDisable.call(e,e.STENCIL_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(t.ctxAttribs.alpha||u())&&(t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(t.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(t.attribs.position),e.enableVertexAttribArray(t.attribs.texCoord),e.vertexAttribPointer(t.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(t.attribs.texCoord,3,e.FLOAT,!1,20,8),t.instanceExt&&(0!=i&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.position,0),0!=n&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.texCoord,0)),e.activeTexture(e.TEXTURE0),e.uniform1i(t.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.uniform4fv(t.uniforms.viewportOffsetScale,t.viewportOffsetScale),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_SHORT,0),t.cardboardUI&&t.cardboardUI.renderNoState(),t.realBindFramebuffer.call(t.gl,e.FRAMEBUFFER,t.framebuffer),t.ctxAttribs.preserveDrawingBuffer||(t.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),t.dirtySubmitFrameBindings||t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.cullFace&&t.realEnable.call(e,e.CULL_FACE),t.depthTest&&t.realEnable.call(e,e.DEPTH_TEST),t.blend&&t.realEnable.call(e,e.BLEND),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realEnable.call(e,e.STENCIL_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),!t.ctxAttribs.alpha&&t.ctxAttribs.preserveDrawingBuffer||t.realClearColor.apply(e,t.clearColor),t.instanceExt&&(0!=i&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.position,i),0!=n&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.texCoord,n))})),u()){var n=e.canvas;n.width==t.bufferWidth&&n.height==t.bufferHeight||(t.bufferWidth=n.width,t.bufferHeight=n.height,t.onResize())}},H.prototype.updateDeviceInfo=function(e){var t=this.gl,i=this,n=[t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING];k(t,n,(function(t){var n=i.computeMeshVertices_(i.meshWidth,i.meshHeight,e);if(t.bindBuffer(t.ARRAY_BUFFER,i.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),!i.indexCount){var r=i.computeMeshIndices_(i.meshWidth,i.meshHeight);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),i.indexCount=r.length}}))},H.prototype.computeMeshVertices_=function(e,t,i){for(var n=new Float32Array(2*e*t*5),r=i.getLeftEyeVisibleTanAngles(),s=i.getLeftEyeNoLensTanAngles(),a=i.getLeftEyeVisibleScreenRect(s),o=0,l=0;l<2;l++){for(var u=0;u<t;u++)for(var h=0;h<e;h++,o++){var d=h/(e-1),p=u/(t-1),A=d,f=p,m=c(r[0],r[2],d),g=c(r[3],r[1],p),v=Math.sqrt(m*m+g*g),y=i.distortion.distortInverse(v),w=g*y/v;d=(m*y/v-s[0])/(s[2]-s[0]),p=(w-s[3])/(s[1]-s[3]),d=2*(a.x+d*a.width-.5),p=2*(a.y+p*a.height-.5),n[5*o+0]=d,n[5*o+1]=p,n[5*o+2]=A,n[5*o+3]=f,n[5*o+4]=l}var b=r[2]-r[0];r[0]=-(b+r[0]),r[2]=b-r[2],b=s[2]-s[0],s[0]=-(b+s[0]),s[2]=b-s[2],a.x=1-(a.x+a.width)}return n},H.prototype.computeMeshIndices_=function(e,t){for(var i=new Uint16Array(2*(e-1)*(t-1)*6),n=e/2,r=t/2,s=0,a=0,o=0;o<2;o++)for(var l=0;l<t;l++)for(var c=0;c<e;c++,s++)0!=c&&0!=l&&(c<=n==l<=r?(i[a++]=s,i[a++]=s-e-1,i[a++]=s-e,i[a++]=s-e-1,i[a++]=s,i[a++]=s-1):(i[a++]=s-1,i[a++]=s-e,i[a++]=s,i[a++]=s-e,i[a++]=s-1,i[a++]=s-e-1));return i},H.prototype.getOwnPropertyDescriptor_=function(e,t){var i=Object.getOwnPropertyDescriptor(e,t);return void 0!==i.get&&void 0!==i.set||(i.configurable=!0,i.enumerable=!0,i.get=function(){return this.getAttribute(t)},i.set=function(e){this.setAttribute(t,e)}),i};var V=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),z=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),Q=Math.PI/180,j=60,X=12,W=20,Y=1,q=.75,Z=.3125,K=4,J=28,$=1.5;function ee(e){this.gl=e,this.attribs={position:0},this.program=M(e,V,z,this.attribs),this.uniforms=_(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function te(e){this.coefficients=e}ee.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener("click",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},ee.prototype.listen=function(e,t){var i=this.gl.canvas;this.listener=function(n){var r=i.clientWidth/2,s=J*$;n.clientX>r-s&&n.clientX<r+s&&n.clientY>i.clientHeight-s?e(n):n.clientX<s&&n.clientY<s&&t(n)},i.addEventListener("click",this.listener,!1)},ee.prototype.onResize=function(){var e=this.gl,t=this,i=[e.ARRAY_BUFFER_BINDING];k(e,i,(function(e){var i=[],n=e.drawingBufferWidth/2,r=Math.max(screen.width,screen.height)*window.devicePixelRatio,s=e.drawingBufferWidth/r*window.devicePixelRatio,a=K*s/2,o=J*$*s,l=J*s/2,c=(J*$-J)*s;function u(e,t){var r=(90-e)*Q,s=Math.cos(r),a=Math.sin(r);i.push(Z*s*l+n,Z*a*l+l),i.push(t*s*l+n,t*a*l+l)}i.push(n-a,o),i.push(n-a,e.drawingBufferHeight),i.push(n+a,o),i.push(n+a,e.drawingBufferHeight),t.gearOffset=i.length/2;for(var h=0;h<=6;h++){var d=h*j;u(d,Y),u(d+X,Y),u(d+W,q),u(d+(j-W),q),u(d+(j-X),Y)}function p(t,n){i.push(c+t,e.drawingBufferHeight-c-n)}t.gearVertexCount=i.length/2-t.gearOffset,t.arrowOffset=i.length/2;var A=a/Math.sin(45*Q);p(0,l),p(l,0),p(l+A,A),p(A,l+A),p(A,l-A),p(0,l),p(l,2*l),p(l+A,2*l-A),p(A,l-A),p(0,l),p(A,l-a),p(J*s,l-a),p(A,l+a),p(J*s,l+a),t.arrowVertexCount=i.length/2-t.arrowOffset,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(i),e.STATIC_DRAW)}))},ee.prototype.render=function(){var e=this.gl,t=this,i=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];k(e,i,(function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.renderNoState()}))},ee.prototype.renderNoState=function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(this.attribs.position),e.vertexAttribPointer(this.attribs.position,2,e.FLOAT,!1,8,0),e.uniform4f(this.uniforms.color,1,1,1,1),T(this.projMat,0,e.drawingBufferWidth,0,e.drawingBufferHeight,.1,1024),e.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.drawArrays(e.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),e.drawArrays(e.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},te.prototype.distortInverse=function(e){for(var t=0,i=1,n=e-this.distort(t);Math.abs(i-t)>1e-4;){var r=e-this.distort(i),s=i-r*((i-t)/(r-n));t=i,i=s,n=r}return i},te.prototype.distort=function(e){for(var t=e*e,i=0,n=0;n<this.coefficients.length;n++)i=t*(i+this.coefficients[n]);return(i+1)*e};var ie=Math.PI/180,ne=180/Math.PI,re=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};re.prototype={constructor:re,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();if(0!==e){var t=1/e;this.multiplyScalar(t)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*n-a*i,c=o*i+a*t-r*n,u=o*n+r*i-s*t,h=-r*t-s*i-a*n;return this.x=l*o+h*-r+c*-a-u*-s,this.y=c*o+h*-s+u*-r-l*-a,this.z=u*o+h*-a+l*-s-c*-r,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}};var se,ae,oe,le=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1};function ce(e){this.width=e.width||w(),this.height=e.height||b(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}le.prototype={constructor:le,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,t,i){var n=Math.cos(e/2),r=Math.cos(t/2),s=Math.cos(i/2),a=Math.sin(e/2),o=Math.sin(t/2),l=Math.sin(i/2);return this.x=a*r*s+n*o*l,this.y=n*o*s-a*r*l,this.z=n*r*l+a*o*s,this.w=n*r*s-a*o*l,this},setFromEulerYXZ:function(e,t,i){var n=Math.cos(e/2),r=Math.cos(t/2),s=Math.cos(i/2),a=Math.sin(e/2),o=Math.sin(t/2),l=Math.sin(i/2);return this.x=a*r*s+n*o*l,this.y=n*o*s-a*r*l,this.z=n*r*l-a*o*s,this.w=n*r*s+a*o*l,this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(i),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,n=e.y,r=e.z,s=e.w,a=t.x,o=t.y,l=t.z,c=t.w;return this.x=i*c+s*a+n*l-r*o,this.y=n*c+s*o+r*a-i*l,this.z=r*c+s*l+i*o-n*a,this.w=s*c-i*a-n*o-r*l,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this.x,n=this.y,r=this.z,s=this.w,a=s*e.w+i*e.x+n*e.y+r*e.z;if(a<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=s,this.x=i,this.y=n,this.z=r,this;var o=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this.w=.5*(s+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(r+this.z),this;var c=Math.sin((1-t)*o)/l,u=Math.sin(t*o)/l;return this.w=s*c+this.w*u,this.x=i*c+this.x*u,this.y=n*c+this.y*u,this.z=r*c+this.z*u,this},setFromUnitVectors:(oe=1e-6,function(e,t){return void 0===se&&(se=new re),(ae=e.dot(t)+1)<oe?(ae=0,Math.abs(e.x)>Math.abs(e.z)?se.set(-e.y,e.x,0):se.set(0,-e.z,e.y)):se.crossVectors(e,t),this.x=se.x,this.y=se.y,this.z=se.z,this.w=ae,this.normalize(),this})};var ue=new ce({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),he=new ce({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),de={CardboardV1:new Ae({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Ae({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function pe(e,t){this.viewer=de.CardboardV2,this.updateDeviceParams(e),this.distortion=new te(this.viewer.distortionCoefficients);for(var i=0;i<t.length;i++){var n=t[i];de[n.id]=new Ae(n)}}function Ae(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}pe.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},pe.prototype.getDevice=function(){return this.device},pe.prototype.setViewer=function(e){this.viewer=e,this.distortion=new te(this.viewer.distortionCoefficients)},pe.prototype.determineDevice_=function(e){if(!e)return u()?(console.warn("Using fallback iOS device measurements."),he):(console.warn("Using fallback Android device measurements."),ue);var t=.0254,i=t/e.xdpi,n=t/e.ydpi;return new ce({widthMeters:i*w(),heightMeters:n*b(),bevelMeters:.001*e.bevelMm})},pe.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,i=this.distortion,n=e.screenLensDistance,r=(t.widthMeters-e.interLensDistance)/2,s=e.interLensDistance/2,a=e.baselineLensDistance-t.bevelMeters,o=t.heightMeters-a,l=ne*Math.atan(i.distort(r/n)),c=ne*Math.atan(i.distort(s/n)),u=ne*Math.atan(i.distort(a/n)),h=ne*Math.atan(i.distort(o/n));return{leftDegrees:Math.min(l,e.fov),rightDegrees:Math.min(c,e.fov),downDegrees:Math.min(u,e.fov),upDegrees:Math.min(h,e.fov)}},pe.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,n=Math.tan(-ie*e.fov),r=Math.tan(ie*e.fov),s=Math.tan(ie*e.fov),a=Math.tan(-ie*e.fov),o=t.widthMeters/4,l=t.heightMeters/2,c=e.baselineLensDistance-t.bevelMeters-l,u=e.interLensDistance/2-o,h=-c,d=e.screenLensDistance,p=i.distort((u-o)/d),A=i.distort((h+l)/d),f=i.distort((u+o)/d),m=i.distort((h-l)/d),g=new Float32Array(4);return g[0]=Math.max(n,p),g[1]=Math.min(r,A),g[2]=Math.min(s,f),g[3]=Math.max(a,m),g},pe.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,n=new Float32Array(4),r=i.distortInverse(Math.tan(-ie*e.fov)),s=i.distortInverse(Math.tan(ie*e.fov)),a=i.distortInverse(Math.tan(ie*e.fov)),o=i.distortInverse(Math.tan(-ie*e.fov)),l=t.widthMeters/4,c=t.heightMeters/2,u=e.baselineLensDistance-t.bevelMeters-c,h=e.interLensDistance/2-l,d=-u,p=e.screenLensDistance,A=(h-l)/p,f=(d+c)/p,m=(h+l)/p,g=(d-c)/p;return n[0]=Math.max(r,A),n[1]=Math.min(s,f),n[2]=Math.min(a,m),n[3]=Math.max(o,g),n},pe.prototype.getLeftEyeVisibleScreenRect=function(e){var t=this.viewer,i=this.device,n=t.screenLensDistance,r=(i.widthMeters-t.interLensDistance)/2,s=t.baselineLensDistance-i.bevelMeters,a=(e[0]*n+r)/i.widthMeters,o=(e[1]*n+s)/i.heightMeters,l=(e[2]*n+r)/i.widthMeters,c=(e[3]*n+s)/i.heightMeters;return{x:a,y:c,width:l-a,height:o-c}},pe.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},pe.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},pe.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:ne*Math.atan(e.outerDist),rightDegrees:ne*Math.atan(e.innerDist),downDegrees:ne*Math.atan(e.bottomDist),upDegrees:ne*Math.atan(e.topDist)}},pe.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,i=this.device,n=t.screenLensDistance,r=i.widthMeters/n,s=i.heightMeters/n,a=i.width/r,o=i.height/s,l=Math.round((e.eyePosX-e.outerDist)*a),c=Math.round((e.eyePosY-e.bottomDist)*o);return{x:l,y:c,width:Math.round((e.eyePosX+e.innerDist)*a)-l,height:Math.round((e.eyePosY+e.topDist)*o)-c}},pe.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,i=this.distortion,n=e.screenLensDistance,r=e.interLensDistance/2/n,s=t.widthMeters/n,a=t.heightMeters/n,o=s/2-r,l=(e.baselineLensDistance-t.bevelMeters)/n,c=e.fov,u=i.distortInverse(Math.tan(ie*c)),h=Math.min(o,u),d=Math.min(r,u),p=Math.min(l,u);return{outerDist:h,innerDist:d,topDist:Math.min(a-l,u),bottomDist:p,eyePosX:o,eyePosY:l}},pe.Viewers=de;var fe={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function me(e,t){if(this.dpdb=fe,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t;var i=new XMLHttpRequest,n=this;i.open("GET",e,!0),i.addEventListener("load",(function(){n.loading=!1,i.status>=200&&i.status<=299?(n.dpdb=JSON.parse(i.response),n.recalculateDeviceParams_()):console.error("Error loading online DPDB!")})),i.send()}}function ge(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}function ve(e,t){this.set(e,t)}function ye(e,t){this.kFilter=e,this.isDebug=t,this.currentAccelMeasurement=new ve,this.currentGyroMeasurement=new ve,this.previousGyroMeasurement=new ve,u()?this.filterQ=new le(-1,0,0,1):this.filterQ=new le(1,0,0,1),this.previousFilterQ=new le,this.previousFilterQ.copy(this.filterQ),this.accelQ=new le,this.isOrientationInitialized=!1,this.estimatedGravity=new re,this.measuredGravity=new re,this.gyroIntegralQ=new le}function we(e,t){this.predictionTimeS=e,this.isDebug=t,this.previousQ=new le,this.previousTimestampS=null,this.deltaQ=new le,this.outQ=new le}function be(e,t,i,n){this.yawOnly=i,this.accelerometer=new re,this.gyroscope=new re,this.filter=new ye(e,n),this.posePredictor=new we(t,n),this.isFirefoxAndroid=p(),this.isIOS=u();var r=A();this.isDeviceMotionInRadians=!this.isIOS&&r&&r<66,this.isWithoutDeviceMotion=m()||f(),this.filterToWorldQ=new le,u()?this.filterToWorldQ.setFromAxisAngle(new re(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new re(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new le,this.worldToScreenQ=new le,this.originalPoseAdjustQ=new le,this.originalPoseAdjustQ.setFromAxisAngle(new re(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),v()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new le,this.orientationOut_=new Float32Array(4),this.start()}me.prototype.getDeviceParams=function(){return this.deviceParams},me.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},me.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return console.error("DPDB not available."),null;if(1!=e.format)return console.error("DPDB has unexpected format version."),null;if(!e.devices||!e.devices.length)return console.error("DPDB does not have a devices section."),null;var t=navigator.userAgent||navigator.vendor||window.opera,i=w(),n=b();if(!e.devices)return console.error("DPDB has no devices section."),null;for(var r=0;r<e.devices.length;r++){var s=e.devices[r];if(s.rules)if("ios"==s.type||"android"==s.type){if(u()==("ios"==s.type)){for(var a=!1,o=0;o<s.rules.length;o++){var l=s.rules[o];if(this.ruleMatches_(l,t,i,n)){a=!0;break}}if(a)return new ge({xdpi:s.dpi[0]||s.dpi,ydpi:s.dpi[1]||s.dpi,bevelMm:s.bw})}}else console.warn("Device["+r+"] has invalid type.");else console.warn("Device["+r+"] has no rules section.")}return console.warn("No DPDB device match."),null},me.prototype.ruleMatches_=function(e,t,i,n){if(!e.ua&&!e.res)return!1;if(e.ua&&"SM"===e.ua.substring(0,2)&&(e.ua=e.ua.substring(0,7)),e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var r=e.res[0],s=e.res[1];if(Math.min(i,n)!=Math.min(r,s)||Math.max(i,n)!=Math.max(r,s))return!1}return!0},ve.prototype.set=function(e,t){this.sample=e,this.timestampS=t},ve.prototype.copy=function(e){this.set(e.sample,e.timestampS)},ye.prototype.addAccelMeasurement=function(e,t){this.currentAccelMeasurement.set(e,t)},ye.prototype.addGyroMeasurement=function(e,t){this.currentGyroMeasurement.set(e,t);var i=t-this.previousGyroMeasurement.timestampS;y(i)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},ye.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(t),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(t);var i=new le;i.copy(this.filterQ),i.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(i),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n=new le;n.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),n.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",ne*D(n),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var r=new le;r.copy(this.filterQ),r.multiply(n),this.filterQ.slerp(r,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},ye.prototype.getOrientation=function(){return this.filterQ},ye.prototype.accelToQuaternion_=function(e){var t=new re;t.copy(e),t.normalize();var i=new le;return i.setFromUnitVectors(new re(0,0,-1),t),i.inverse(),i},ye.prototype.gyroToQuaternionDelta_=function(e,t){var i=new le,n=new re;return n.copy(e),n.normalize(),i.setFromAxisAngle(n,e.length()*t),i},we.prototype.getPrediction=function(e,t,i){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=i,e;var n=new re;n.copy(t),n.normalize();var r=t.length();if(r<20*ie)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(ne*r).toFixed(1)),this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var s=r*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(n,s),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.previousTimestampS=i,this.outQ},be.prototype.getPosition=function(){return null},be.prototype.getOrientation=function(){var e=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ)return this.deviceOrientationFixQ=this.deviceOrientationFixQ||(i=(new le).setFromAxisAngle(new re(0,0,-1),0),n=new le,-90===window.orientation?n.setFromAxisAngle(new re(0,1,0),Math.PI/-2):n.setFromAxisAngle(new re(0,1,0),Math.PI/2),i.multiply(n)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||((t=new le).setFromAxisAngle(new re(1,0,0),-Math.PI/2),t),e=this._deviceOrientationQ,(r=new le).copy(e),r.multiply(this.deviceOrientationFilterToWorldQ),r.multiply(this.resetQ),r.multiply(this.worldToScreenQ),r.multiplyQuaternions(this.deviceOrientationFixQ,r),this.yawOnly&&(r.x=0,r.z=0,r.normalize()),this.orientationOut_[0]=r.x,this.orientationOut_[1]=r.y,this.orientationOut_[2]=r.z,this.orientationOut_[3]=r.w,this.orientationOut_;var t,i,n,r,s=this.filter.getOrientation();return e=this.posePredictor.getPrediction(s,this.gyroscope,this.previousTimestampS),(r=new le).copy(this.filterToWorldQ),r.multiply(this.resetQ),r.multiply(e),r.multiply(this.worldToScreenQ),this.yawOnly&&(r.x=0,r.z=0,r.normalize()),this.orientationOut_[0]=r.x,this.orientationOut_[1]=r.y,this.orientationOut_[2]=r.z,this.orientationOut_[3]=r.w,this.orientationOut_},be.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),v()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},be.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new le;var t=e.alpha,i=e.beta,n=e.gamma;t=(t||0)*Math.PI/180,i=(i||0)*Math.PI/180,n=(n||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(i,t,-n)},be.prototype.onDeviceMotion_=function(e){this.updateDeviceMotion_(e)},be.prototype.updateDeviceMotion_=function(e){var t=e.accelerationIncludingGravity,i=e.rotationRate,n=e.timeStamp/1e3,r=n-this.previousTimestampS;return r<0?(O("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),void(this.previousTimestampS=n)):r<=a||r>o?(O("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),void(this.previousTimestampS=n)):(this.accelerometer.set(-t.x,-t.y,-t.z),i&&(g()?this.gyroscope.set(-i.beta,i.alpha,i.gamma):this.gyroscope.set(i.alpha,i.beta,i.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,n)),this.filter.addAccelMeasurement(this.accelerometer,n),void(this.previousTimestampS=n))},be.prototype.onOrientationChange_=function(e){this.setScreenTransform_()},be.prototype.onMessage_=function(e){var t=e.data;t&&t.type&&"devicemotion"===t.type.toLowerCase()&&this.updateDeviceMotion_(t.deviceMotionEvent)},be.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new re(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new re(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},be.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),u()&&I()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},be.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var Ee=60,xe=new re(1,0,0),Se=new re(0,0,1),Me=new le;Me.setFromAxisAngle(xe,-Math.PI/2),Me.multiply((new le).setFromAxisAngle(Se,Math.PI/2));var _e=function(){function e(t){n(this,e),this.config=t,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new le,this._outQ=new le,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return r(e,[{key:"init",value:function(){var e=null;try{(e=new RelativeOrientationSensor({frequency:Ee,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(e){this.errors.push(e),"SecurityError"===e.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===e.name?this.useDeviceMotion():console.error(e)}e&&(this.api="sensor",this.sensor=e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new be(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var e=this.sensor.quaternion;this._sensorQ.set(e[0],e[1],e[2],e[3]);var t=this._outQ;return t.copy(Me),t.multiply(this._sensorQ),this.config.YAW_ONLY&&(t.x=t.z=0,t.normalize()),this._out[0]=t.x,this._out[1]=t.y,this._out[2]=t.z,this._out[3]=t.w,this._out}},{key:"_onSensorError",value:function(e){this.errors.push(e.error),"NotAllowedError"===e.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===e.error.name?console.error("Sensor could not be read"):console.error(e.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),e}(),Te="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Re(){this.loadIcon_();var e=document.createElement("div");(s=e.style).position="fixed",s.top=0,s.right=0,s.bottom=0,s.left=0,s.backgroundColor="gray",s.fontFamily="sans-serif",s.zIndex=1e6;var t=document.createElement("img");t.src=this.icon,(s=t.style).marginLeft="25%",s.marginTop="25%",s.width="50%",e.appendChild(t);var i=document.createElement("div");(s=i.style).textAlign="center",s.fontSize="16px",s.lineHeight="24px",s.margin="24px 25%",s.width="50%",i.innerHTML="Place your phone into your Cardboard viewer.",e.appendChild(i);var n=document.createElement("div");(s=n.style).backgroundColor="#CFD8DC",s.position="fixed",s.bottom=0,s.width="100%",s.height="48px",s.padding="14px 24px",s.boxSizing="border-box",s.color="#656A6B",e.appendChild(n);var r=document.createElement("div");r.style.float="left",r.innerHTML="No Cardboard viewer?";var s,a=document.createElement("a");a.href="https://www.google.com/get/cardboard/get-cardboard/",a.innerHTML="get one",a.target="_blank",(s=a.style).float="right",s.fontWeight=600,s.textTransform="uppercase",s.borderLeft="1px solid gray",s.paddingLeft="24px",s.textDecoration="none",s.color="#656A6B",n.appendChild(r),n.appendChild(a),this.overlay=e,this.text=i,this.hide()}Re.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var t=this.overlay.querySelector("img").style;v()?(t.width="20%",t.marginLeft="40%",t.marginTop="3%"):(t.width="50%",t.marginLeft="25%",t.marginTop="25%")},Re.prototype.hide=function(){this.overlay.style.display="none"},Re.prototype.showTemporarily=function(e,t){this.show(t),this.timer=setTimeout(this.hide.bind(this),e)},Re.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Re.prototype.update=function(){this.disableShowTemporarily(),!v()&&R()?this.show():this.hide()},Re.prototype.loadIcon_=function(){this.icon=l("image/svg+xml",Te)};var Pe="CardboardV1",Fe="WEBVR_CARDBOARD_VIEWER",Ce="webvr-polyfill-viewer-selector";function Ie(e){try{this.selectedKey=localStorage.getItem(Fe)}catch(e){console.error("Failed to load viewer profile: %s",e)}this.selectedKey||(this.selectedKey=e||Pe),this.dialog=this.createDialog_(pe.Viewers),this.root=null,this.onChangeCallbacks_=[]}function Le(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function De(e,t){return e(t={exports:{}},t.exports),t.exports}Ie.prototype.show=function(e){this.root=e,e.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},Ie.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Ie.prototype.getCurrentViewer=function(){return pe.Viewers[this.selectedKey]},Ie.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector("input[name=field]:checked");return e?e.id:null},Ie.prototype.onChange=function(e){this.onChangeCallbacks_.push(e)},Ie.prototype.fireOnChange_=function(e){for(var t=0;t<this.onChangeCallbacks_.length;t++)this.onChangeCallbacks_[t](e)},Ie.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&pe.Viewers[this.selectedKey]){this.fireOnChange_(pe.Viewers[this.selectedKey]);try{localStorage.setItem(Fe,this.selectedKey)}catch(e){console.error("Failed to save viewer profile: %s",e)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},Ie.prototype.createDialog_=function(e){var t=document.createElement("div");t.classList.add(Ce),t.style.display="none";var i=document.createElement("div");(s=i.style).position="fixed",s.left=0,s.top=0,s.width="100%",s.height="100%",s.background="rgba(0, 0, 0, 0.3)",i.addEventListener("click",this.hide.bind(this));var n=280,r=document.createElement("div"),s=r.style;for(var a in s.boxSizing="border-box",s.position="fixed",s.top="24px",s.left="50%",s.marginLeft=-n/2+"px",s.width=n+"px",s.padding="24px",s.overflow="hidden",s.background="#fafafa",s.fontFamily="'Roboto', sans-serif",s.boxShadow="0px 5px 20px #666",r.appendChild(this.createH1_("Select your viewer")),e)r.appendChild(this.createChoice_(a,e[a].label));return r.appendChild(this.createButton_("Save",this.onSave_.bind(this))),t.appendChild(i),t.appendChild(r),t},Ie.prototype.createH1_=function(e){var t=document.createElement("h1"),i=t.style;return i.color="black",i.fontSize="20px",i.fontWeight="bold",i.marginTop=0,i.marginBottom="24px",t.innerHTML=e,t},Ie.prototype.createChoice_=function(e,t){var i=document.createElement("div");i.style.marginTop="8px",i.style.color="black";var n=document.createElement("input");n.style.fontSize="30px",n.setAttribute("id",e),n.setAttribute("type","radio"),n.setAttribute("value",e),n.setAttribute("name","field");var r=document.createElement("label");return r.style.marginLeft="4px",r.setAttribute("for",e),r.innerHTML=t,i.appendChild(n),i.appendChild(r),i},Ie.prototype.createButton_=function(e,t){var i=document.createElement("button");i.innerHTML=e;var n=i.style;return n.float="right",n.textTransform="uppercase",n.color="#1094f7",n.fontSize="14px",n.letterSpacing=0,n.border=0,n.background="none",n.marginTop="16px",i.addEventListener("click",t),i},"undefined"!=typeof window?window:void 0!==ii||"undefined"!=typeof self&&self;var Oe=Le(De((function(e,t){!function(t,i){e.exports=i()}(0,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(1),a="undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,o=function(){function e(){r(this,e),a?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",s),this.noSleepVideo.addEventListener("timeupdate",function(e){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return n(e,[{key:"enable",value:function(){a?(this.disable(),this.noSleepTimer=window.setInterval((function(){window.location.href="/",window.setTimeout(window.stop,0)}),15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){a?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),e}();e.exports=o},function(e,t,i){e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])}))}))),Be=1e3,Ne=[0,0,.5,1],ke=[.5,0,.5,1],Ge=window.requestAnimationFrame,Ue=window.cancelAnimationFrame;function He(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Ve(e){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:e.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:e.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:e.canPresent},maxLayers:{writable:!1,enumerable:!0,value:e.maxLayers},hasOrientation:{enumerable:!0,get:function(){return B("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),e.hasOrientation}}})}function ze(e){var t=!("wakelock"in(e=e||{}))||e.wakelock;this.isPolyfilled=!0,this.displayId=Be++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return B("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Ve({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,t&&R()&&(this.wakelock_=new Oe)}ze.prototype.getFrameData=function(e){return C(e,this._getPose(),this)},ze.prototype.getPose=function(){return B("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},ze.prototype.resetPose=function(){return B("VRDisplay.prototype.resetPose"),this._resetPose()},ze.prototype.getImmediatePose=function(){return B("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},ze.prototype.requestAnimationFrame=function(e){return Ge(e)},ze.prototype.cancelAnimationFrame=function(e){return Ue(e)},ze.prototype.wrapForFullscreen=function(e){if(u())return e;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var t=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",t.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==e)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=e,this.originalParent_=e.parentElement,this.originalParent_||document.body.appendChild(e),!this.fullscreenWrapper_.parentElement){var i=this.fullscreenElement_.parentElement;i.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),i.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var n=this;function r(){if(n.fullscreenElement_){var e=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];n.fullscreenElement_.setAttribute("style",e.join("; ")+";")}}return r(),this.fullscreenWrapper_},ze.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElementCachedStyle_?e.setAttribute("style",this.fullscreenElementCachedStyle_):e.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var t=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),this.originalParent_===t?t.insertBefore(e,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(e),t.removeChild(this.fullscreenWrapper_),e}},ze.prototype.requestPresent=function(e){var t=this.isPresenting,i=this;return e instanceof Array||(B("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),e=[e]),new Promise((function(n,r){if(i.capabilities.canPresent)if(0==e.length||e.length>i.capabilities.maxLayers)r(new Error("Invalid number of layers."));else{var s=e[0];if(s.source){var a=s.leftBounds||Ne,o=s.rightBounds||ke;if(t){var l=i.layer_;l.source!==s.source&&(l.source=s.source);for(var c=0;c<4;c++)l.leftBounds[c]=a[c],l.rightBounds[c]=o[c];return i.wrapForFullscreen(i.layer_.source),i.updatePresent_(),void n()}if(i.layer_={predistorted:s.predistorted,source:s.source,leftBounds:a.slice(0),rightBounds:o.slice(0)},i.waitingForPresent_=!1,i.layer_&&i.layer_.source){var d=i.wrapForFullscreen(i.layer_.source),p=function(){var e=S();i.isPresenting=d===e,i.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch((function(e){console.error("screen.orientation.lock() failed due to",e.message)})),i.waitingForPresent_=!1,i.beginPresent_(),n()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),i.removeFullscreenWrapper(),i.disableWakeLock(),i.endPresent_(),i.removeFullscreenListeners_()),i.fireVRDisplayPresentChange_()},A=function(){i.waitingForPresent_&&(i.removeFullscreenWrapper(),i.removeFullscreenListeners_(),i.disableWakeLock(),i.waitingForPresent_=!1,i.isPresenting=!1,r(new Error("Unable to present.")))};i.addFullscreenListeners_(d,p,A),E(d)?(i.enableWakeLock(),i.waitingForPresent_=!0):(u()||h())&&(i.enableWakeLock(),i.isPresenting=!0,i.beginPresent_(),i.fireVRDisplayPresentChange_(),n())}i.waitingForPresent_||u()||(x(),r(new Error("Unable to present.")))}else n()}else r(new Error("VRDisplay is not capable of presenting."))}))},ze.prototype.exitPresent=function(){var e=this.isPresenting,t=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise((function(i,n){e?(!x()&&u()&&(t.endPresent_(),t.fireVRDisplayPresentChange_()),h()&&(t.removeFullscreenWrapper(),t.removeFullscreenListeners_(),t.endPresent_(),t.fireVRDisplayPresentChange_()),i()):n(new Error("Was not presenting to VRDisplay."))}))},ze.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},ze.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(e)},ze.prototype.fireVRDisplayConnect_=function(){var e=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(e)},ze.prototype.addFullscreenListeners_=function(e,t,i){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=t,this.fullscreenErrorHandler_=i,t&&(document.fullscreenEnabled?e.addEventListener("fullscreenchange",t,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenchange",t,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",t,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenchange",t,!1)),i&&(document.fullscreenEnabled?e.addEventListener("fullscreenerror",i,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenerror",i,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",i,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenerror",i,!1))},ze.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var t=this.fullscreenChangeHandler_;e.removeEventListener("fullscreenchange",t,!1),e.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),e.removeEventListener("msfullscreenchange",t,!1)}if(this.fullscreenErrorHandler_){var i=this.fullscreenErrorHandler_;e.removeEventListener("fullscreenerror",i,!1),e.removeEventListener("webkitfullscreenerror",i,!1),document.removeEventListener("mozfullscreenerror",i,!1),e.removeEventListener("msfullscreenerror",i,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},ze.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},ze.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},ze.prototype.beginPresent_=function(){},ze.prototype.endPresent_=function(){},ze.prototype.submitFrame=function(e){},ze.prototype.getEyeParameters=function(e){return null};var Qe={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},je={LEFT:"left",RIGHT:"right"};function Xe(e){var t=P({},Qe);e=P(t,e||{}),ze.call(this,{wakelock:e.MOBILE_WAKE_LOCK}),this.config=e,this.displayName="Cardboard VRDisplay",this.capabilities=new Ve({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new _e(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new me(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new pe(this.dpdb_.getDeviceParams(),e.ADDITIONAL_VIEWERS),this.viewerSelector_=new Ie(e.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Re),u()&&window.addEventListener("resize",this.onResize_.bind(this))}return Xe.prototype=Object.create(ze.prototype),Xe.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Xe.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Xe.prototype._getFieldOfView=function(e){var t;if(e==je.LEFT)t=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=je.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=this.deviceInfo_.getFieldOfViewRightEye()}return t},Xe.prototype._getEyeOffset=function(e){var t;if(e==je.LEFT)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(e!=je.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return t},Xe.prototype.getEyeParameters=function(e){var t=this._getEyeOffset(e),i=this._getFieldOfView(e),n={offset:t,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(n,"fieldOfView",{enumerable:!0,get:function(){return B("VRFieldOfView","VRFrameData's projection matrices"),i}}),n},Xe.prototype.onDeviceParamsUpdated_=function(e){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Xe.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Xe.prototype.beginPresent_=function(){var e=this.layer_.source.getContext("webgl");e||(e=this.layer_.source.getContext("experimental-webgl")),e||(e=this.layer_.source.getContext("webgl2")),e&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(e.canvas.width=w()*this.bufferScale_,e.canvas.height=b()*this.bufferScale_,this.cardboardUI_=new ee(e)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new ee(e)),this.distorter_=new H(e,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(e){this.viewerSelector_.show(this.layer_.source.parentElement),e.stopPropagation(),e.preventDefault()}.bind(this),function(e){this.exitPresent(),e.stopPropagation(),e.preventDefault()}.bind(this)),this.rotateInstructions_&&(v()&&R()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Xe.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Xe.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Xe.prototype.submitFrame=function(e){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2"));var i=t.canvas;i.width==this.lastWidth&&i.height==this.lastHeight||this.cardboardUI_.onResize(),this.lastWidth=i.width,this.lastHeight=i.height,this.cardboardUI_.render()}},Xe.prototype.onOrientationChange_=function(e){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Xe.prototype.onResize_=function(e){if(this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2"));var i=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];t.canvas.setAttribute("style",i.join("; ")+";"),F(t.canvas)}},Xe.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Xe.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},Xe.VRFrameData=He,Xe.VRDisplay=ze,Xe}()}(ni={exports:{}},ni.exports),ni.exports),ai=(ri=si)&&ri.__esModule&&Object.prototype.hasOwnProperty.call(ri,"default")?ri.default:ri;class oi extends Le{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(e,t){throw new Error("Not implemented")}isSessionSupported(e){throw new Error("Not implemented")}isFeatureSupported(e){throw new Error("Not implemented")}async requestSession(e,t){throw new Error("Not implemented")}requestAnimationFrame(e){throw new Error("Not implemented")}onFrameStart(e){throw new Error("Not implemented")}onFrameEnd(e){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(e,t){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw new Error("Not implemented")}endSession(e){throw new Error("Not implemented")}getViewport(e,t,i,n){throw new Error("Not implemented")}getProjectionMatrix(e){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(e){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(e,t,i){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}}let li={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},ci={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},ui={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},hi={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},di={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},pi={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},Ai={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},"Gear VR Controller":hi,"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":li,"Oculus Touch (Right)":ci,"Oculus Touch (Left)":ci,"OpenVR Gamepad":ui,"Spatial Controller (Spatial Interaction Source) 045E-065A":pi,"Spatial Controller (Spatial Interaction Source) 045E-065D":di,"Windows Mixed Reality (Right)":pi,"Windows Mixed Reality (Left)":pi};const fi=je(.155,-.465,-.15),mi=je(-.155,-.465,-.15),gi=je(0,0,-.25),vi=je(0,0,.05),yi=je(-.08,.14,.08),wi=180/Math.PI;class bi{constructor(){this.hand="right",this.headElbowOffset=fi,this.controllerQ=et(),this.lastControllerQ=et(),this.headQ=et(),this.headPos=ze(),this.elbowPos=ze(),this.wristPos=ze(),this.time=null,this.lastTime=null,this.rootQ=et(),this.position=ze()}setHandedness(e){this.hand!=e&&(this.hand=e,"left"==this.hand?this.headElbowOffset=mi:this.headElbowOffset=fi)}update(e,t){this.time=yt(),e&&(at(this.lastControllerQ,this.controllerQ),at(this.controllerQ,e)),t&&(Ue(this.headPos,t),He(this.headQ,t));let i=this.getHeadYawOrientation_(),n=this.quatAngle_(this.lastControllerQ,this.controllerQ);n/((this.time-this.lastTime)/1e3)>.61?it(this.rootQ,this.rootQ,i,Math.min(n/.175,1)):at(this.rootQ,i);let r=je(0,0,-1);Je(r,r,this.controllerQ);let s=Ze(r,[0,1,0]),a=this.clamp_((s-.12)/.87,0,1),o=rt(this.rootQ);nt(o,o),tt(o,o,this.controllerQ);let l=this.elbowPos;Xe(l,this.headPos),We(l,l,this.headElbowOffset);let c=Qe(yi);Ye(c,c,a),We(l,l,c);let u=this.quatAngle_(o,et())*wi,h=(1-Math.pow(u/180,4))*(.4+.6*a*.4),d=et();it(d,d,o,h);let p=nt(et(),d),A=rt(o);tt(A,A,p);let f=this.wristPos;Xe(f,vi),Je(f,f,d),We(f,f,gi),Je(f,f,A),We(f,f,l);let m=Qe(yi);Ye(m,m,a),We(this.position,this.wristPos,m),Je(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let e=ze();return function(e,t,i){function n(e,t,i){return e<t?t:e>i?i:e}var r=t[0]*t[0],s=t[1]*t[1],a=t[2]*t[2],o=t[3]*t[3];if("XYZ"===i)e[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),o-r-s+a),e[1]=Math.asin(n(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),o+r-s-a);else if("YXZ"===i)e[0]=Math.asin(n(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),o-r-s+a),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),o-r+s-a);else if("ZXY"===i)e[0]=Math.asin(n(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),o-r-s+a),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),o-r+s-a);else if("ZYX"===i)e[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),o-r-s+a),e[1]=Math.asin(n(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),o+r-s-a);else if("YZX"===i)e[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),o-r+s-a),e[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),o+r-s-a),e[2]=Math.asin(n(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else{if("XZY"!==i)return void console.log("No order given for quaternion to euler conversion.");e[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),o-r+s-a),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),o+r-s-a),e[2]=Math.asin(n(2*(t[2]*t[3]-t[0]*t[1]),-1,1))}}(e,this.headQ,"YXZ"),function(e,t,i,n){let r=.5*Math.PI/180;t*=r,i*=r,n*=r;let s=Math.sin(t),a=Math.cos(t),o=Math.sin(i),l=Math.cos(i),c=Math.sin(n),u=Math.cos(n);return e[0]=s*l*u-a*o*c,e[1]=a*o*u+s*l*c,e[2]=a*l*c-s*o*u,e[3]=a*l*u+s*o*c,e}(et(),0,e[1]*wi,0)}clamp_(e,t,i){return Math.min(Math.max(e,t),i)}quatAngle_(e,t){let i=[0,0,-1],n=[0,0,-1];return Je(i,i,e),Je(n,n,t),function(e,t){let i=je(e[0],e[1],e[2]),n=je(t[0],t[1],t[2]);qe(i,i),qe(n,n);let r=Ze(i,n);return r>1?0:r<-1?Math.PI:Math.acos(r)}(i,n)}}const Ei=Symbol("@@webxr-polyfill/XRRemappedGamepad"),xi={pressed:!1,touched:!1,value:0};Object.freeze(xi);class Si{constructor(e,t,i){if(i||(i={}),i.userAgentOverrides)for(let e in i.userAgentOverrides)if(navigator.userAgent.includes(e)){let t=i.userAgentOverrides[e];for(let e in t)e in i?Object.assign(i[e],t[e]):i[e]=t[e];break}let n=new Array(i.axes&&i.axes.length?i.axes.length:e.axes.length),r=new Array(i.buttons&&i.buttons.length?i.buttons.length:e.buttons.length),s=null;if(i.gripTransform){let e=i.gripTransform.orientation||[0,0,0,1];s=Oe(),Ge(s,ot(e,e),i.gripTransform.position||[0,0,0])}let a=null;if(i.targetRayTransform){let e=i.targetRayTransform.orientation||[0,0,0,1];a=Oe(),Ge(a,ot(e,e),i.targetRayTransform.position||[0,0,0])}let o=i.profiles;i.displayProfiles&&t.displayName in i.displayProfiles&&(o=i.displayProfiles[t.displayName]),this[Ei]={gamepad:e,map:i,profiles:o||[e.id],mapping:i.mapping||e.mapping,axes:n,buttons:r,gripTransform:s,targetRayTransform:a},this._update()}_update(){let e=this[Ei].gamepad,t=this[Ei].map,i=this[Ei].axes;for(let n=0;n<i.length;++n)t.axes&&n in t.axes?null===t.axes[n]?i[n]=0:i[n]=e.axes[t.axes[n]]:i[n]=e.axes[n];if(t.axes&&t.axes.invert)for(let e of t.axes.invert)e<i.length&&(i[e]*=-1);let n=this[Ei].buttons;for(let i=0;i<n.length;++i)t.buttons&&i in t.buttons?null===t.buttons[i]?n[i]=xi:n[i]=e.buttons[t.buttons[i]]:n[i]=e.buttons[i]}get id(){return""}get _profiles(){return this[Ei].profiles}get index(){return-1}get connected(){return this[Ei].gamepad.connected}get timestamp(){return this[Ei].gamepad.timestamp}get mapping(){return this[Ei].mapping}get axes(){return this[Ei].axes}get buttons(){return this[Ei].buttons}get hapticActuators(){return this[Ei].gamepad.hapticActuators}}class Mi{constructor(e,t,i=0,n=-1){this.polyfill=e,this.display=t,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Zt(this),this.lastPosition=ze(),this.emulatedPosition=!1,this.basePoseMatrix=Oe(),this.outputMatrix=Oe(),this.primaryButtonIndex=i,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=n,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(e){this.nativeGamepad!==e&&(this.nativeGamepad=e,this.gamepad=e?new Si(e,this.display,Ai[e.id]):null),this.handedness=""===e.hand?"none":e.hand,this.gamepad&&this.gamepad._update(),e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):""===e.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let e=this.nativeGamepad.pose,t=e.position,i=e.orientation;if(!t&&!i)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new bi),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(i,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),Ge(this.basePoseMatrix,i,t)}else e=this.basePoseMatrix,t=this.polyfill.getBasePoseMatrix(),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15];var e,t;return this.basePoseMatrix}getXRPose(e,t){switch(this.updateBasePoseMatrix(),t){case"target-ray":e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Ei].targetRayTransform&&ke(this.outputMatrix,this.outputMatrix,this.gamepad[Ei].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Ei].gripTransform&&ke(this.outputMatrix,this.outputMatrix,this.gamepad[Ei].gripTransform);break;default:return null}return e._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}}const _i={highRefreshRate:!0},Ti={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1};let Ri=0;class Pi{constructor(e,t,i={}){if(this.mode=e,this.enabledFeatures=t,this.outputContext=null,this.immersive="immersive-vr"==e||"immersive-ar"==e,this.ended=null,this.baseLayer=null,this.id=++Ri,this.modifiedCanvasLayer=!1,this.outputContext){const e=i.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(e)}}}class Fi extends oi{constructor(e,t){const{canPresent:i}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=i,this.baseModelMatrix=Oe(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=(e=>!(!e.ImageBitmapRenderingContext||!e.createImageBitmap))(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){const i=this.sessions.get(e),n=t.context.canvas;if(i.immersive){const e=this.display.getEyeParameters("left"),r=this.display.getEyeParameters("right");n.width=2*Math.max(e.renderWidth,r.renderWidth),n.height=Math.max(e.renderHeight,r.renderHeight),this.display.requestPresent([{source:n,attributes:_i}]).then((()=>{this.global.document.body.contains(n)||(i.modifiedCanvasLayer=!0,this.global.document.body.appendChild(n),(e=>{e.style.display="block",e.style.position="absolute",e.style.width=e.style.height="1px",e.style.top=e.style.left="0px"})(n)),i.baseLayer=t}))}else i.baseLayer=t}isSessionSupported(e){return"immersive-ar"!=e&&("immersive-vr"!=e||!1!==this.canPresent)}isFeatureSupported(e){switch(e){case"viewer":case"local":case"local-floor":return!0;case"bounded":case"unbounded":default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let i="immersive-vr"==e;if(i){const e=this.global.document.createElement("canvas");e.getContext("webgl");await this.display.requestPresent([{source:e,attributes:_i}])}const n=new Pi(e,t,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(n.id,n),i&&(this.immersiveSession=n,this.dispatchEvent("@@webxr-polyfill/vr-present-start",n.id)),Promise.resolve(n.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,i=e.id.toLowerCase();for(let e in Ti)if(i.includes(e)){t=Ti[e];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e,t){this.display.depthNear=t.depthNear,this.display.depthFar=t.depthFar,this.display.getFrameData(this.frame);const i=this.sessions.get(e);if(i.immersive&&this.CAN_USE_GAMEPAD){let e=this.gamepadInputSources;this.gamepadInputSources={};let t=this.global.navigator.getGamepads();for(let n=0;n<t.length;++n){let r=t[n];if(r&&r.displayId>0){let t=e[n];if(t||(t=new Mi(this,this.display,this.getPrimaryButtonIndex(r))),t.updateFromGamepad(r),this.gamepadInputSources[n]=t,-1!=t.primaryButtonIndex){let e=r.buttons[t.primaryButtonIndex].pressed;e&&!t.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:i.id,inputSource:t.inputSource}):!e&&t.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:i.id,inputSource:t.inputSource}),t.primaryActionPressed=e}if(-1!=t.primarySqueezeButtonIndex){let e=r.buttons[t.primarySqueezeButtonIndex].pressed;e&&!t.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:i.id,inputSource:t.inputSource}):!e&&t.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:i.id,inputSource:t.inputSource}),t.primarySqueezeActionPressed=e}}}}if(!i.immersive&&i.baseLayer){const e=i.baseLayer.context.canvas;Ve(this.frame.leftProjectionMatrix,t.inlineVerticalFieldOfView,e.width/e.height,t.depthNear,t.depthFar)}}onFrameEnd(e){const t=this.sessions.get(e);if(!t.ended&&t.baseLayer){if(t.outputContext&&(!t.immersive||this.display.capabilities.hasExternalDisplay)){const e=t.immersive&&this.display.capabilities.hasExternalDisplay,i=t.baseLayer.context.canvas,n=e?i.width/2:i.width,r=i.height;{const e=t.outputContext.canvas,s=e.width,a=e.height,o=t.renderContext;this.HAS_BITMAP_SUPPORT?i.transferToImageBitmap?o.transferFromImageBitmap(i.transferToImageBitmap()):this.global.createImageBitmap(i,0,0,n,r,{resizeWidth:s,resizeHeight:a}).then((e=>o.transferFromImageBitmap(e))):o.drawImage(i,0,0,n,r,0,0,s,a)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){const t=this.sessions.get(e);if(!t.ended)return t.immersive?this.display.exitPresent():void(t.ended=!0)}doesSessionSupportReferenceSpace(e,t){const i=this.sessions.get(e);return!i.ended&&i.enabledFeatures.has(t)}requestStageBounds(){if(this.display.stageParameters){const e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,i=[];return i.push(-e/2),i.push(-t/2),i.push(e/2),i.push(-t/2),i.push(e/2),i.push(t/2),i.push(-e/2),i.push(t/2),i}return null}async requestFrameOfReferenceTransform(e,t){return("local-floor"===e||"bounded-floor"===e)&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(e){if("left"===e)return this.frame.leftProjectionMatrix;if("right"===e)return this.frame.rightProjectionMatrix;if("none"===e)return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(e,t,i,n){const r=this.sessions.get(e),{width:s,height:a}=i.context.canvas;if(!r.immersive)return n.x=n.y=0,n.width=s,n.height=a,!0;if("left"===t||"none"===t)n.x=0;else{if("right"!==t)return!1;n.x=s/2}return n.y=0,n.width=s/2,n.height=a,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return e||t?(e||(e=this.tempVec3,e[0]=e[1]=e[2]=0),Ge(this.baseModelMatrix,t,e),this.baseModelMatrix):this.baseModelMatrix}getBaseViewMatrix(e){if("left"===e||"none"===e)return this.frame.leftViewMatrix;if("right"===e)return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t,i){if(!t)return null;for(let n in this.gamepadInputSources){let r=this.gamepadInputSources[n];if(r.inputSource===e)return r.getXRPose(t,i)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach((e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){const t=e.baseLayer.context.canvas;document.body.removeChild(t),t.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}}))}}class Ci extends Fi{constructor(e,t){const i=new ai(t||{});super(e,i),this.display=i,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}}let Ii=0;class Li{constructor(e,t){this.mode=e,this.enabledFeatures=t,this.ended=null,this.baseLayer=null,this.id=++Ii}}class Di extends oi{constructor(e){super(e),this.sessions=new Map,this.projectionMatrix=Oe(),this.identityMatrix=Oe()}onBaseLayerSet(e,t){this.sessions.get(e).baseLayer=t}isSessionSupported(e){return"inline"==e}isFeatureSupported(e){switch(e){case"viewer":return!0;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();const i=new Li(e,t);return this.sessions.set(i.id,i),Promise.resolve(i.id)}requestAnimationFrame(e){return window.requestAnimationFrame(e)}cancelAnimationFrame(e){window.cancelAnimationFrame(e)}onFrameStart(e,t){const i=this.sessions.get(e);if(i.baseLayer){const e=i.baseLayer.context.canvas;Ve(this.projectionMatrix,t.inlineVerticalFieldOfView,e.width/e.height,t.depthNear,t.depthFar)}}onFrameEnd(e){}async endSession(e){this.sessions.get(e).ended=!0}doesSessionSupportReferenceSpace(e,t){const i=this.sessions.get(e);return!i.ended&&i.enabledFeatures.has(t)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(e,t){return null}getProjectionMatrix(e){return this.projectionMatrix}getViewport(e,t,i,n){this.sessions.get(e);const{width:r,height:s}=i.context.canvas;return n.x=n.y=0,n.width=r,n.height=s,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(e){return this.identityMatrix}getInputSources(){return[]}getInputPose(e,t,i){return null}onWindowResize(){}}const Oi=async function(e,t){if(t.webvr){let t=await async function(e){let t=null;if("getVRDisplays"in e.navigator)try{const i=await e.navigator.getVRDisplays();i&&i.length&&(t=new Fi(e,i[0]))}catch(e){}return t}(e);if(t)return t}let i=(e=>{var t,i=!1;return t=e.navigator.userAgent||e.navigator.vendor||e.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(i=!0),i})(e);return i&&t.cardboard||!i&&t.allowCardboardOnDesktop?(e.VRFrameData||(e.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Ci(e,t.cardboardConfig)):new Di(e)},Bi={global:Ce,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},Ni=["navigator","HTMLCanvasElement","WebGLRenderingContext"];var ki,Gi,Ui="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},Hi=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(e=void 0!==e?e:Ui();i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++){var r=this._tweens[i[n]];r&&!1===r.update(e)&&!t&&delete this._tweens[i[n]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),Vi={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-Vi.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Vi.Bounce.In(2*e):.5*Vi.Bounce.Out(2*e-1)+.5}}},zi={Linear:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),s=zi.Utils.Linear;return t<0?s(e[0],e[1],n):t>1?s(e[i],e[i-1],i-n):s(e[r],e[r+1>i?i:r+1],n-r)},Bezier:function(e,t){for(var i=0,n=e.length-1,r=Math.pow,s=zi.Utils.Bernstein,a=0;a<=n;a++)i+=r(1-t,n-a)*r(t,a)*e[a]*s(n,a);return i},CatmullRom:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),s=zi.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(r=Math.floor(n=i*(1+t))),s(e[(r-1+i)%i],e[r],e[(r+1)%i],e[(r+2)%i],n-r)):t<0?e[0]-(s(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[i]-(s(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):s(e[r?r-1:0],e[r],e[i<r+1?i:r+1],e[i<r+2?i:r+2],n-r)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=zi.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:(ki=[1],function(e){var t=1;if(ki[e])return ki[e];for(var i=e;i>1;i--)t*=i;return ki[e]=t,t}),CatmullRom:function(e,t,i,n,r){var s=.5*(i-e),a=.5*(n-t),o=r*r;return(2*t-2*i+s+a)*(r*o)+(-3*t+3*i-2*s-a)*o+s*r+t}}},Qi=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),ji=function(){function e(e,t){void 0===t&&(t=Wi),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Wi.Easing.Linear.None,this._interpolationFunction=Wi.Interpolation.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Wi.nextId(),this._isChainStopped=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){for(var i in e)this._valuesEnd[i]=e[i];return void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.start=function(e){if(this._isPlaying)return this;if(this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==e?"string"==typeof e?Wi.now()+parseFloat(e):e:Wi.now(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,i,n){for(var r in i){var s=e[r],a=Array.isArray(s),o=a?"array":typeof s,l=!a&&Array.isArray(i[r]);if("undefined"!==o&&"function"!==o){if(l){var c=i[r];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,s)),i[r]=[s].concat(c)}if("object"!==o&&!a||!s||l)void 0===t[r]&&(t[r]=s),a||(t[r]*=1),n[r]=l?i[r].slice().reverse():t[r]||0;else{for(var u in t[r]=a?[]:{},s)t[r][u]=s[u];n[r]=a?[]:{},this._setupProperties(s,t[r],i[r],n[r])}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this.update(1/0),this},e.prototype.pause=function(e){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=void 0===e?Wi.now():e,this._group.remove(this)),this},e.prototype.resume=function(e){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=(void 0===e?Wi.now():e)-this._pauseStart,this._pauseStart=0,this._group.add(this),this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return this._group=e,this},e.prototype.delay=function(e){return this._delayTime=e,this},e.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return this._yoyo=e,this},e.prototype.easing=function(e){return this._easingFunction=e,this},e.prototype.interpolation=function(e){return this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e){var t,i;if(e>this._startTime+this._duration&&!this._isPlaying)return!1;if(this.isPlaying||this.start(e),e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,i=0===this._duration||i>1?1:i;var n=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,n),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[t]||(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo&&this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var r=0,s=this._chainedTweens.length;r<s;r++)this._chainedTweens[r].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,i,n){for(var r in i)if(void 0!==t[r]){var s=t[r]||0,a=i[r],o=Array.isArray(e[r]),l=Array.isArray(a);!o&&l?e[r]=this._interpolationFunction(a,n):"object"==typeof a&&a?this._updateProperties(e[r],s,a,n):"number"==typeof(a=this._handleRelativeValue(s,a))&&(e[r]=s+(a-s)*n)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e];"string"==typeof this._valuesEnd[e]?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e]):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},e}(),Xi=(Gi=function(e,t){return(Gi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Gi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Wi=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.version="18.6.0",t.now=Ui,t.Group=Hi,t.Easing=Vi,t.Interpolation=zi,t.nextId=Qi.nextId,t.Tween=ji,t}return Xi(t,e),t}(Hi));const Yi=new o,qi=document.querySelector("canvas"),Zi=qi.getContext("webgl2",{antialias:!0}),Ki=new l({canvas:qi,context:Zi});Ki.xr.enabled=!0,Ki.logarithmicDepthBuffer=!0,Ki.setPixelRatio(window.devicePixelRatio);const Ji=new c;Ji.name="xrgarden",window.scene=Ji;const $i=new u;$i.far=1e3,Yi.add($i),Ji.add(Yi);const en=new Pe($i,Ki.domElement);function tn(){const e=window.innerWidth,t=window.innerHeight;$i.aspect=window.innerWidth/window.innerHeight,$i.updateProjectionMatrix(),Ki.setSize(e,t)}en.maxPolarAngle=.5*Math.PI,en.maxDistance=10,$i.position.set(0,1.6,-5),en.target=new e(0,1,0),en.update(),window.addEventListener("resize",tn,!1),tn();const nn=new h(16755251);nn.position.set(-500,500,500),nn.intensity=1,Ji.add(nn),nn.add(new d(new p(50,32,32),new A({color:16755251})));const rn=new f(14707);rn.intensity=1,Ji.add(rn);const sn=new p(500,50,50,0,2*Math.PI),an=new A({side:m,depthWrite:!1});an.onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("#include <common>","#include <common>\n#define USE_UV"),e.fragmentShader=e.fragmentShader.replace("#include <common>","\n    #include <common>\n    #define USE_UV\n    "),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","\n        vec4 col1 = vec4( 249, 229, 180, 255 ) / 255.0;\n        vec4 col2 = vec4( 0, 57, 115, 255 ) / 255.0;\n        float mixAmount = 0.0;\n        if (vUv.y > 0.5) {\n            float newY = (vUv.y - 0.5) * 2.0;\n            mixAmount = sqrt(newY)*2.0;\n        } else {\n            col1 = vec4(0.6,0.6,0.6,1.0);\n\t\t}\n        diffuseColor *= mix(col1, col2, mixAmount);\n    ")},an.dithering=!0;const on=new d(sn,an);on.name="skysphere",Ji.add(on);const ln=(new g).load("https://cdn.glitch.com/3423c223-e1e5-450d-8cfa-2f5215104916%2Fmemphis-mini.png?v=1579618577700");ln.repeat.multiplyScalar(100),ln.wrapS=ln.wrapT=v;const cn=new d(new y(1e3,1e3,50,50),new w({map:ln}));cn.rotation.x=-Math.PI/2,cn.name="floor",Ji.add(cn);const un=(new g).load("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/waternormals.jpg");un.wrapS=un.wrapT=v,un.repeat.multiplyScalar(10);const hn=new d(new y(1e3,1e3,50,50),new b({normalMap:un,shininess:1,color:9089951,transparent:!0,opacity:.4}));hn.geometry.rotateX(-Math.PI/2),hn.renderOrder=10,hn.position.y=.3,Ji.add(hn),new class{constructor(e={}){this.config=Object.freeze(Object.assign({},Bi,e)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(e){if(!Ni.every((t=>!!e[t])))throw new Error("Global must have the following attributes : "+Ni);for(const t of Object.keys($t))void 0!==e[t]?console.warn(t+" already defined on global."):e[t]=$t[t];ei(e.WebGLRenderingContext)&&(ti(e.HTMLCanvasElement),e.OffscreenCanvas&&ti(e.OffscreenCanvas),e.WebGL2RenderingContext&&ei(e.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let e=Oi(this.global,this.config);this.xr=new $t.XRSystem(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(e){if(!Ni.every((t=>!!e[t])))throw new Error("Global must have the following attributes : "+Ni);if(e.navigator.xr&&"supportsSession"in e.navigator.xr&&!("isSessionSupported"in e.navigator.xr)){let t=e.navigator.xr.supportsSession;e.navigator.xr.isSessionSupported=function(e){return t.call(this,e).then((()=>!0)).catch((()=>!1))},e.navigator.xr.supportsSession=function(e){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),t.call(this,e)}}}};const dn=class{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const i=document.createElement("button");function n(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null,i.textContent="VR NOT SUPPORTED"}function r(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return i.id="VRButton",i.style.display="none",r(i),navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?function(){let t=null;function n(n){n.addEventListener("end",r),e.xr.setSession(n),i.textContent="EXIT VR",t=n}function r(){t.removeEventListener("end",r),i.textContent="ENTER VR",t=null}i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="ENTER VR",i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){if(null===t){const e={optionalFeatures:["local-floor","bounded-floor","hand-tracking"]};navigator.xr.requestSession("immersive-vr",e).then(n)}else t.end()}}():n()})),i;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",r(e),e}}}.createButton(Ki);document.body.appendChild(dn),dn.addEventListener("click",(function(){window.canaudio.checked||window.canaudio.click()}));const pn=new Set;pn.add((function(e){hn.material.normalMap.offset.x+=.01*Math.sin(e/1e4)/500,hn.material.normalMap.offset.y+=.01*Math.cos(e/8e3)/500,hn.material.normalScale.x=10*(.8+.5*Math.cos(e/1e3)),hn.material.normalScale.y=10*(.8+.5*Math.sin(e/1200)),hn.position.y=.4+.1*Math.sin(e/2e3)})),Ki.setAnimationLoop((function(e){Wi.update(e),pn.forEach((t=>t(e))),Ki.render(Ji,$i)}));var An=function(){function t(e){E.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.pluginCallbacks=[],this.register((function(e){return new c(e)})),this.register((function(e){return new f(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new a(e)}))}function i(){var e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}t.prototype=Object.assign(Object.create(E.prototype),{constructor:t,load:function(e,t,i,n){var r,s=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:x.extractUrlBase(e),this.manager.itemStart(e);var a=function(t){n?n(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},o=new S(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){try{s.parse(i,r,(function(i){t(i),s.manager.itemEnd(e)}),a)}catch(e){a(e)}}),i,a)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,i,s){var a,o={},c={};if("string"==typeof e)a=e;else if(x.decodeText(new Uint8Array(e,0,4))===m){try{o[n.KHR_BINARY_GLTF]=new b(e)}catch(e){return void(s&&s(e))}a=o[n.KHR_BINARY_GLTF].content}else a=x.decodeText(new Uint8Array(e));var u=JSON.parse(a);if(void 0===u.asset||u.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var h=new qe(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader});h.fileLoader.setRequestHeader(this.requestHeader);for(var d=0;d<this.pluginCallbacks.length;d++){var p=this.pluginCallbacks[d](h);c[p.name]=p,o[p.name]=!0}if(u.extensionsUsed)for(d=0;d<u.extensionsUsed.length;++d){var A=u.extensionsUsed[d],f=u.extensionsRequired||[];switch(A){case n.KHR_MATERIALS_UNLIT:o[A]=new l;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[A]=new Se;break;case n.KHR_DRACO_MESH_COMPRESSION:o[A]=new be(u,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:o[A]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:o[A]=new Ee;break;case n.KHR_MESH_QUANTIZATION:o[A]=new Me;break;default:f.indexOf(A)>=0&&void 0===c[A]&&console.warn('THREE.GLTFLoader: Unknown extension "'+A+'".')}}h.setExtensions(o),h.setPlugins(c),h.parse(i,s)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function a(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function l(){this.name=n.KHR_MATERIALS_UNLIT}function c(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function p(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}function f(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}a.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],i=0,n=t.length;i<n;i++){var r=t[i];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}},a.prototype._loadLight=function(e){var t=this.parser,i="light:"+e,n=t.cache.get(i);if(n)return n;var r,s=t.json,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e],o=new M(16777215);void 0!==a.color&&o.fromArray(a.color);var l=void 0!==a.range?a.range:0;switch(a.type){case"directional":(r=new h(o)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new te(o)).distance=l;break;case"spot":(r=new ee(o)).distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,r.angle=a.spot.outerConeAngle,r.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+a.type+'".')}return r.position.set(0,0,0),r.decay=2,void 0!==a.intensity&&(r.intensity=a.intensity),r.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(r),t.cache.add(i,n),n},a.prototype.createNodeAttachment=function(e){var t=this,i=this.parser,n=i.json.nodes[e],r=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return i._getNodeRef(t.cache,r,e)}))},l.prototype.getMaterialType=function(){return A},l.prototype.extendParams=function(e,t,i){var n=[];e.color=new M(1,1,1),e.opacity=1;var r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var s=r.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}void 0!==r.baseColorTexture&&n.push(i.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(n)},c.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ie:null},c.prototype.extendMaterialParams=function(e,t){var i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var r=[],a=n.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&r.push(i.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(r.push(i.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new s(o,o)}return Promise.all(r)},p.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ie:null},p.prototype.extendMaterialParams=function(e,t){var i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var r=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(i.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)},f.prototype.loadTexture=function(e){var t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;var r=n.extensions[this.name],s=i.images[r.source],a=t.options.ktx2Loader;if(!a)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return t.loadTextureImage(e,s,a)};var m="glTF",y=1313821514,w=5130562;function b(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:x.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==m)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=new DataView(e,12),r=0;r<i.byteLength;){var s=i.getUint32(r,!0);r+=4;var a=i.getUint32(r,!0);if(r+=4,a===y){var o=new Uint8Array(e,12+r,s);this.content=x.decodeText(o)}else if(a===w){var l=12+r;this.body=e.slice(l,l+s)}r+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function be(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function Ee(){this.name=n.KHR_TEXTURE_TRANSFORM}function xe(e){_.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new M).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(var o in a)e.uniforms[o]=a[o];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function Se(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return xe},extendParams:function(e,t,i){var n=t.extensions[this.name];e.color=new M(1,1,1),e.opacity=1;var r=[];if(Array.isArray(n.diffuseFactor)){var s=n.diffuseFactor;e.color.fromArray(s),e.opacity=s[3]}if(void 0!==n.diffuseTexture&&r.push(i.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new M(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new M(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var a=n.specularGlossinessTexture;r.push(i.assignTexture(e,"glossinessMap",a)),r.push(i.assignTexture(e,"specularMap",a))}return Promise.all(r)},createMaterial:function(e){var t=new xe(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=T,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function Me(){this.name=n.KHR_MESH_QUANTIZATION}function _e(e,t,i,n){ne.call(this,e,t,i,n)}be.prototype.decodePrimitive=function(e,t){var i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},o={},l={};for(var c in s){var u=ke[c]||c.toLowerCase();a[u]=s[c]}for(c in e.attributes){u=ke[c]||c.toLowerCase();if(void 0!==s[c]){var h=i.accessors[e.attributes[c]],d=De[h.componentType];l[u]=d,o[u]=!0===h.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(var i in e.attributes){var n=e.attributes[i],r=o[i];void 0!==r&&(n.normalized=r)}t(e)}),a,l)}))}))},Ee.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},xe.prototype=Object.create(_.prototype),xe.prototype.constructor=xe,xe.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},_e.prototype=Object.create(ne.prototype),_e.prototype.constructor=_e,_e.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n,s=0;s!==n;s++)t[s]=i[r+s];return t},_e.prototype.beforeStart_=_e.prototype.copySampleValue_,_e.prototype.afterEnd_=_e.prototype.copySampleValue_,_e.prototype.interpolate_=function(e,t,i,n){for(var r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,c=n-t,u=(i-t)/c,h=u*u,d=h*u,p=e*l,A=p-l,f=-2*d+3*h,m=d-h,g=1-f,v=m-h+u,y=0;y!==a;y++){var w=s[A+y+a],b=s[A+y+o]*c,E=s[p+y+a],x=s[p+y]*c;r[y]=g*w+v*b+f*E+m*x}return r};var Te=0,Re=1,Pe=2,Fe=3,Ce=4,Ie=5,Le=6,De={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Oe={9728:re,9729:I,9984:se,9985:ae,9986:oe,9987:L},Be={33071:le,33648:ce,10497:v},Ne={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ke={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ge={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ue={CUBICSPLINE:void 0,LINEAR:Y,STEP:ue},He="OPAQUE",Ve="MASK",ze="BLEND";function Qe(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function je(e,t,i){for(var n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function Xe(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function We(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(i=0,n=r.length;i<n;i++)e.morphTargetDictionary[r[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ye(e){for(var t="",i=Object.keys(e).sort(),n=0,r=i.length;n<r;n++)t+=i[n]+":"+e[i[n]]+";";return t}function qe(e,t){this.json=e||{},this.extensions={},this.plugins={},this.options=t||{},this.cache=new i,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new R(this.options.manager):this.textureLoader=new g(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new S(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function Ze(t,i,n){var r=i.attributes,s=[];function a(e,i){return n.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(var o in r){var l=ke[o]||o.toLowerCase();l in t.attributes||s.push(a(r[o],l))}if(void 0!==i.indices&&!t.index){var c=n.getDependency("accessor",i.indices).then((function(e){t.setIndex(e)}));s.push(c)}return Xe(t,i),function(t,i,n){var r=i.attributes,s=new ye;if(void 0!==r.POSITION){var a=(p=n.json.accessors[r.POSITION]).min,o=p.max;if(void 0!==a&&void 0!==o){s.set(new e(a[0],a[1],a[2]),new e(o[0],o[1],o[2]));var l=i.targets;if(void 0!==l){for(var c=new e,u=new e,h=0,d=l.length;h<d;h++){var p,A=l[h];if(void 0!==A.POSITION)a=(p=n.json.accessors[A.POSITION]).min,o=p.max,void 0!==a&&void 0!==o?(u.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),u.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),u.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),c.max(u)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}s.expandByVector(c)}t.boundingBox=s;var f=new we;s.getCenter(f.center),f.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,i,n),Promise.all(s).then((function(){return void 0!==i.targets?function(e,t,i){for(var n=!1,r=!1,s=0,a=t.length;s<a&&(void 0!==(c=t[s]).POSITION&&(n=!0),void 0!==c.NORMAL&&(r=!0),!n||!r);s++);if(!n&&!r)return Promise.resolve(e);var o=[],l=[];for(s=0,a=t.length;s<a;s++){var c=t[s];if(n){var u=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;o.push(u)}r&&(u=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal,l.push(u))}return Promise.all([Promise.all(o),Promise.all(l)]).then((function(t){var i=t[0],s=t[1];return n&&(e.morphAttributes.position=i),r&&(e.morphAttributes.normal=s),e.morphTargetsRelative=!0,e}))}(t,i.targets,n):t}))}function Ke(e,t){var i=e.getIndex();if(null===i){var n=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var s=0;s<r.count;s++)n.push(s);e.setIndex(n),i=e.getIndex()}var a=i.count-2,o=[];if(t===Ae)for(s=1;s<=a;s++)o.push(i.getX(0)),o.push(i.getX(s)),o.push(i.getX(s+1));else for(s=0;s<a;s++)s%2==0?(o.push(i.getX(s)),o.push(i.getX(s+1)),o.push(i.getX(s+2))):(o.push(i.getX(s+2)),o.push(i.getX(s+1)),o.push(i.getX(s)));o.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(o),l}return qe.prototype.setExtensions=function(e){this.extensions=e},qe.prototype.setPlugins=function(e){this.plugins=e},qe.prototype.parse=function(e,t){var i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var s={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:i,userData:{}};je(r,s,n),Xe(s,n),e(s)})).catch(t)},qe.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],n=0,r=t.length;n<r;n++)for(var s=t[n].joints,a=0,o=s.length;a<o;a++)e[s[a]].isBone=!0;for(var l=0,c=e.length;l<c;l++){var u=e[l];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(i[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}},qe.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},qe.prototype._getNodeRef=function(e,t,i){if(e.refs[t]<=1)return i;var n=i.clone();return n.name+="_instance_"+e.uses[t]++,n},qe.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var i=0;i<t.length;i++){var n=e(t[i]);if(n)return n}},qe.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var i=[],n=0;n<t.length;n++){var r=e(t[n]);r&&i.push(r)}return i},qe.prototype.getDependency=function(e,t){var i=e+":"+t,n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,n)}return n},qe.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return i.getDependency(e,n)}))),this.cache.add(e,t)}return t},qe.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,n){i.load(Qe(t.uri,r.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},qe.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)}))},qe.prototype.loadAccessor=function(e){var t=this,i=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then((function(e){var r,s,a=e[0],o=Ne[n.type],l=De[n.componentType],c=l.BYTES_PER_ELEMENT,u=c*o,h=n.byteOffset||0,d=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,p=!0===n.normalized;if(d&&d!==u){var A=Math.floor(h/d),f="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+A+":"+n.count,m=t.cache.get(f);m||(r=new l(a,A*d,n.count*d/c),m=new P(r,d/c),t.cache.add(f,m)),s=new de(m,o,h%d/c,p)}else r=null===a?new l(n.count*o):new l(a,h,n.count*o),s=new F(r,o,p);if(void 0!==n.sparse){var g=Ne.SCALAR,v=De[n.sparse.indices.componentType],y=n.sparse.indices.byteOffset||0,w=n.sparse.values.byteOffset||0,b=new v(e[1],y,n.sparse.count*g),E=new l(e[2],w,n.sparse.count*o);null!==a&&(s=new F(s.array.slice(),s.itemSize,s.normalized));for(var x=0,S=b.length;x<S;x++){var M=b[x];if(s.setX(M,E[x*o]),o>=2&&s.setY(M,E[x*o+1]),o>=3&&s.setZ(M,E[x*o+2]),o>=4&&s.setW(M,E[x*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return s}))},qe.prototype.loadTexture=function(e){var t,i,r=this.json,s=this.options,a=r.textures[e],o=a.extensions||{};return(t=o[n.MSFT_TEXTURE_DDS]?r.images[o[n.MSFT_TEXTURE_DDS].source]:r.images[a.source]).uri&&(i=s.manager.getHandler(t.uri)),i||(i=o[n.MSFT_TEXTURE_DDS]?this.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,i)},qe.prototype.loadTextureImage=function(e,t,i){var n=this,r=this.json,s=this.options,a=r.textures[e],o=self.URL||self.webkitURL,l=t.uri,c=!1,u=!0;return"image/jpeg"===t.mimeType&&(u=!1),void 0!==t.bufferView&&(l=n.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var i=new DataView(e,25,1).getUint8(0,!1);u=6===i||4===i||3===i}c=!0;var n=new Blob([e],{type:t.mimeType});return l=o.createObjectURL(n)}))),Promise.resolve(l).then((function(e){return new Promise((function(t,n){var r=t;!0===i.isImageBitmapLoader&&(r=function(e){t(new pe(e))}),i.load(Qe(e,s.path),r,void 0,n)}))})).then((function(t){!0===c&&o.revokeObjectURL(l),t.flipY=!1,a.name&&(t.name=a.name),u||(t.format=C);var i=(r.samplers||{})[a.sampler]||{};return t.magFilter=Oe[i.magFilter]||I,t.minFilter=Oe[i.minFilter]||L,t.wrapS=Be[i.wrapS]||v,t.wrapT=Be[i.wrapT]||v,n.associations.set(t,{type:"textures",index:e}),t}))},qe.prototype.assignTexture=function(e,t,i){var r=this;return this.getDependency("texture",i.index).then((function(s){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===t&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),r.extensions[n.KHR_TEXTURE_TRANSFORM]){var a=void 0!==i.extensions?i.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(a){var o=r.associations.get(s);s=r.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(s,a),r.associations.set(s,o)}}e[t]=s}))},qe.prototype.assignFinalMaterial=function(e){var t=e.geometry,i=e.material,n=void 0!==t.attributes.tangent,r=void 0!==t.attributes.color,s=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,o=Object.keys(t.morphAttributes).length>0,l=o&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+i.uuid,u=this.cache.get(c);u||(u=new D,O.prototype.copy.call(u,i),u.color.copy(i.color),u.map=i.map,u.sizeAttenuation=!1,this.cache.add(c,u)),i=u}else if(e.isLine){c="LineBasicMaterial:"+i.uuid;var h=this.cache.get(c);h||(h=new B,O.prototype.copy.call(h,i),h.color.copy(i.color),this.cache.add(c,h)),i=h}if(n||r||s||a||o){c="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),a&&(c+="skinning:"),n&&(c+="vertex-tangents:"),r&&(c+="vertex-colors:"),s&&(c+="flat-shading:"),o&&(c+="morph-targets:"),l&&(c+="morph-normals:");var d=this.cache.get(c);d||(d=i.clone(),a&&(d.skinning=!0),n&&(d.vertexTangents=!0),r&&(d.vertexColors=!0),s&&(d.flatShading=!0),o&&(d.morphTargets=!0),l&&(d.morphNormals=!0),this.cache.add(c,d),this.associations.set(d,this.associations.get(i))),i=d}i.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),i.normalScale&&!n&&(i.normalScale.y=-i.normalScale.y),i.clearcoatNormalScale&&!n&&(i.clearcoatNormalScale.y=-i.clearcoatNormalScale.y),e.material=i},qe.prototype.getMaterialType=function(){return _},qe.prototype.loadMaterial=function(e){var t,i=this,r=this.json,a=this.extensions,o=r.materials[e],l={},c=o.extensions||{},u=[];if(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=h.getMaterialType(),u.push(h.extendParams(l,o,i))}else if(c[n.KHR_MATERIALS_UNLIT]){var d=a[n.KHR_MATERIALS_UNLIT];t=d.getMaterialType(),u.push(d.extendParams(l,o,i))}else{var p=o.pbrMetallicRoughness||{};if(l.color=new M(1,1,1),l.opacity=1,Array.isArray(p.baseColorFactor)){var f=p.baseColorFactor;l.color.fromArray(f),l.opacity=f[3]}void 0!==p.baseColorTexture&&u.push(i.assignTexture(l,"map",p.baseColorTexture)),l.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,l.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(u.push(i.assignTexture(l,"metalnessMap",p.metallicRoughnessTexture)),u.push(i.assignTexture(l,"roughnessMap",p.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),u.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===o.doubleSided&&(l.side=N);var m=o.alphaMode||He;return m===ze?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,m===Ve&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==A&&(u.push(i.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new s(1,1),void 0!==o.normalTexture.scale&&l.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==A&&(u.push(i.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==A&&(l.emissive=(new M).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==A&&u.push(i.assignTexture(l,"emissiveMap",o.emissiveTexture)),Promise.all(u).then((function(){var r;return r=t===xe?a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new t(l),o.name&&(r.name=o.name),r.map&&(r.map.encoding=k),r.emissiveMap&&(r.emissiveMap.encoding=k),Xe(r,o),i.associations.set(r,{type:"materials",index:e}),o.extensions&&je(a,r,o),r}))},qe.prototype.createUniqueName=function(e){for(var t=G.sanitizeNodeName(e||""),i=1;this.nodeNamesUsed[t];++i)t=e+"_"+i;return this.nodeNamesUsed[t]=!0,t},qe.prototype.loadGeometries=function(e){var t=this,i=this.extensions,r=this.primitiveCache;function s(e){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return Ze(i,e,t)}))}for(var a,o,l=[],c=0,u=e.length;c<u;c++){var h,d=e[c],p=(o=void 0,(o=(a=d).extensions&&a.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+o.bufferView+":"+o.indices+":"+Ye(o.attributes):a.indices+":"+Ye(a.attributes)+":"+a.mode),A=r[p];if(A)l.push(A.promise);else h=d.extensions&&d.extensions[n.KHR_DRACO_MESH_COMPRESSION]?s(d):Ze(new U,d,t),r[p]={primitive:d,promise:h},l.push(h)}return Promise.all(l)},qe.prototype.loadMesh=function(e){for(var t,i=this,n=this.json.meshes[e],r=n.primitives,s=[],a=0,l=r.length;a<l;a++){var c=void 0===r[a].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new _({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:he})),t.DefaultMaterial):this.getDependency("material",r[a].material);s.push(c)}return s.push(i.loadGeometries(r)),Promise.all(s).then((function(t){for(var s=t.slice(0,t.length-1),a=t[t.length-1],l=[],c=0,u=a.length;c<u;c++){var h,p=a[c],A=r[c],f=s[c];if(A.mode===Ce||A.mode===Ie||A.mode===Le||void 0===A.mode)!0!==(h=!0===n.isSkinnedMesh?new H(p,f):new d(p,f)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),A.mode===Ie?h.geometry=Ke(h.geometry,fe):A.mode===Le&&(h.geometry=Ke(h.geometry,Ae));else if(A.mode===Re)h=new V(p,f);else if(A.mode===Fe)h=new z(p,f);else if(A.mode===Pe)h=new Q(p,f);else{if(A.mode!==Te)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);h=new j(p,f)}Object.keys(h.geometry.morphAttributes).length>0&&We(h,n),h.name=i.createUniqueName(n.name||"mesh_"+e),a.length>1&&(h.name+="_"+c),Xe(h,n),i.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];var m=new o;for(c=0,u=l.length;c<u;c++)m.add(l[c]);return m}))},qe.prototype.loadCamera=function(e){var t,i=this.json.cameras[e],n=i[i.type];if(n)return"perspective"===i.type?t=new u(X.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(t=new W(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Xe(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},qe.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return i.inverseBindMatrices=e,i}))},qe.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],i=[],n=[],r=[],s=[],a=[],o=0,l=t.channels.length;o<l;o++){var c=t.channels[o],u=t.samplers[c.sampler],h=c.target,d=void 0!==h.node?h.node:h.id,p=void 0!==t.parameters?t.parameters[u.input]:u.input,A=void 0!==t.parameters?t.parameters[u.output]:u.output;i.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",p)),r.push(this.getDependency("accessor",A)),s.push(u),a.push(h)}return Promise.all([Promise.all(i),Promise.all(n),Promise.all(r),Promise.all(s),Promise.all(a)]).then((function(i){for(var n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=[],c=0,u=n.length;c<u;c++){var h=n[c],d=r[c],p=s[c],A=a[c],f=o[c];if(void 0!==h){var m;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,Ge[f.path]){case Ge.weights:m=ve;break;case Ge.rotation:m=ge;break;case Ge.position:case Ge.scale:default:m=me}var g=h.name?h.name:h.uuid,v=void 0!==A.interpolation?Ue[A.interpolation]:Y,y=[];Ge[f.path]===Ge.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&y.push(e.name?e.name:e.uuid)})):y.push(g);var w=p.array;if(p.normalized){var b;if(w.constructor===Int8Array)b=1/127;else if(w.constructor===Uint8Array)b=1/255;else if(w.constructor==Int16Array)b=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");b=1/65535}for(var E=new Float32Array(w.length),x=0,S=w.length;x<S;x++)E[x]=w[x]*b;w=E}for(x=0,S=y.length;x<S;x++){var M=new m(y[x]+"."+Ge[f.path],d.array,w,v);"CUBICSPLINE"===A.interpolation&&(M.createInterpolant=function(e){return new _e(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(M)}}}var _=t.name?t.name:"animation_"+e;return new q(_,void 0,l)}))},qe.prototype.loadNode=function(e){var t,i=this.json,n=this.extensions,r=this,s=i.nodes[e],a=s.name?r.createUniqueName(s.name):"";return(t=[],void 0!==s.mesh&&t.push(r.getDependency("mesh",s.mesh).then((function(e){var t=r._getNodeRef(r.meshCache,s.mesh,e);return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))),void 0!==s.camera&&t.push(r.getDependency("camera",s.camera).then((function(e){return r._getNodeRef(r.cameraCache,s.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var i;if((i=!0===s.isBone?new Z:t.length>1?new o:1===t.length?t[0]:new K)!==t[0])for(var l=0,c=t.length;l<c;l++)i.add(t[l]);if(s.name&&(i.userData.name=s.name,i.name=a),Xe(i,s),s.extensions&&je(n,i,s),void 0!==s.matrix){var u=new J;u.fromArray(s.matrix),i.applyMatrix4(u)}else void 0!==s.translation&&i.position.fromArray(s.translation),void 0!==s.rotation&&i.quaternion.fromArray(s.rotation),void 0!==s.scale&&i.scale.fromArray(s.scale);return r.associations.set(i,{type:"nodes",index:e}),i}))},qe.prototype.loadScene=function(){function e(t,i,n,r){var s=n.nodes[t];return r.getDependency("node",t).then((function(e){return void 0===s.skin?e:r.getDependency("skin",s.skin).then((function(e){for(var i=[],n=0,s=(t=e).joints.length;n<s;n++)i.push(r.getDependency("node",t.joints[n]));return Promise.all(i)})).then((function(i){return e.traverse((function(e){if(e.isMesh){for(var n=[],r=[],s=0,a=i.length;s<a;s++){var o=i[s];if(o){n.push(o);var l=new J;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*s),r.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[s])}e.bind(new $(n,r),e.matrixWorld)}})),e}));var t})).then((function(t){i.add(t);var a=[];if(s.children)for(var o=s.children,l=0,c=o.length;l<c;l++){var u=o[l];a.push(e(u,t,n,r))}return Promise.all(a)}))}return function(t){var i=this.json,n=this.extensions,r=this.json.scenes[t],s=new o;r.name&&(s.name=this.createUniqueName(r.name)),Xe(s,r),r.extensions&&je(n,s,r);for(var a=r.nodes||[],l=[],c=0,u=a.length;c<u;c++)l.push(e(a[c],s,i,this));return Promise.all(l).then((function(){return s}))}}(),t}();const fn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function mn(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function gn(e,t,i=null,n=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const r=await async function(e){if(!e)throw new Error("No basePath supplied");return await mn(e+"/profilesList.json")}(t);let s;if(e.profiles.some((e=>{const i=r[e];return i&&(s={profileId:e,profilePath:`${t}/${i.path}`,deprecated:!!i.deprecated}),!!s})),!s){if(!i)throw new Error("No matching profile name found");const e=r[i];if(!e)throw new Error(`No matching profile name found and default profile "${i}" missing.`);s={profileId:i,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const a=await mn(s.profilePath);let o;if(n){let t;if(t="any"===e.handedness?a.layouts[Object.keys(a.layouts)[0]]:a.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${s.profileId}`);t.assetPath&&(o=s.profilePath.replace("profile.json",t.assetPath))}return{profile:a,assetPath:o}}const vn={xAxis:0,yAxis:0,button:0,state:fn.ComponentState.DEFAULT};class yn{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===fn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(vn)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:n}){const{normalizedXAxis:r,normalizedYAxis:s}=function(e=0,t=0){let i=e,n=t;if(Math.sqrt(e*e+t*t)>1){const r=Math.atan2(t,e);i=Math.cos(r),n=Math.sin(r)}return{normalizedXAxis:.5*i+.5,normalizedYAxis:.5*n+.5}}(e,t);switch(this.componentProperty){case fn.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?r:.5;break;case fn.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?s:.5;break;case fn.ComponentProperty.BUTTON:this.value=this.states.includes(n)?i:0;break;case fn.ComponentProperty.STATE:this.valueNodeProperty===fn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error("Unexpected visualResponse componentProperty "+this.componentProperty)}}}class wn{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((e=>{const i=new yn(t.visualResponses[e]);this.visualResponses[e]=i})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:fn.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=fn.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=fn.ComponentState.PRESSED:(t.touched||this.values.button>fn.ButtonTouchThreshold)&&(this.values.state=fn.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===fn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>fn.AxisTouchThreshold&&(this.values.state=fn.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===fn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>fn.AxisTouchThreshold&&(this.values.state=fn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class bn{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const t=this.layoutDescription.components[e];this.components[e]=new wn(e,t)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((t=>{e.push(t.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}function En(){K.call(this),this.motionController=null,this.envMap=null}function xn(e,t){!function(e,t){Object.values(e.components).forEach((e=>{const{type:i,touchPointNodeName:n,visualResponses:r}=e;if(i===fn.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(n),e.touchPointNode){const t=new be(.001),i=new A({color:255}),n=new d(t,i);e.touchPointNode.add(n)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(r).forEach((e=>{const{valueNodeName:i,minNodeName:n,maxNodeName:r,valueNodeProperty:s}=e;if(s===fn.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(n),e.maxNode=t.getObjectByName(r),!e.minNode)return void console.warn(`Could not find ${n} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${r} in the model`)}e.valueNode=t.getObjectByName(i),e.valueNode||console.warn(`Could not find ${i} in the model`)}))}))}(e.motionController,t),e.envMap&&t.traverse((t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}En.prototype=Object.assign(Object.create(K.prototype),{constructor:En,setEnvironmentMap:function(e){return this.envMap==e||(this.envMap=e,this.traverse((e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}))),this},updateMatrixWorld:function(e){K.prototype.updateMatrixWorld.call(this,e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((e=>{Object.values(e.visualResponses).forEach((e=>{const{valueNode:t,minNode:i,maxNode:r,value:s,valueNodeProperty:a}=e;t&&(a===fn.VisualResponseProperty.VISIBILITY?t.visible=s:a===fn.VisualResponseProperty.TRANSFORM&&(n.slerp(i.quaternion,r.quaternion,t.quaternion,s),t.position.lerpVectors(i.position,r.position,s)))}))})))}});var Sn=function(){function e(e=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new An)}return e.prototype={constructor:e,createControllerModel:function(e){const t=new En;let i=null;return e.addEventListener("connected",(e=>{const n=e.data;"tracked-pointer"===n.targetRayMode&&n.gamepad&&gn(n,this.path,"generic-trigger").then((({profile:e,assetPath:r})=>{t.motionController=new bn(n,e,r);const s=this._assetCache[t.motionController.assetUrl];if(s)i=s.scene.clone(),xn(t,i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,(e=>{this._assetCache[t.motionController.assetUrl]=e,i=e.scene.clone(),xn(t,i)}),null,(()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)}))}})).catch((e=>{console.warn(e)}))})),e.addEventListener("disconnected",(()=>{t.motionController=null,t.remove(i),i=null})),t}},e}();const Mn=new Map,_n=new EventTarget;function Tn(e,t){const i=new CustomEvent(e,{detail:t}),n={type:e};Object.assign(n,t);const r=new CustomEvent("gamepadInteraction",{detail:n});_n.dispatchEvent(i),_n.dispatchEvent(r)}pn.add((()=>{const e=Ki.xr.getSession();let t=0;if(e)for(const i of e.inputSources){if(!i.gamepad)continue;const e=Ki.xr.getController(t++),n=Mn.get(i),r={buttons:i.gamepad.buttons.map((e=>e.value)),axes:i.gamepad.axes.slice(0)};n&&(r.buttons.forEach(((t,s)=>{t!==n.buttons[s]&&Tn(1===t?`button${s}Down`:`button${s}Up`,{value:t,source:i,controller:e,data:r})})),r.axes.forEach(((t,s)=>{t!==n.axes[s]&&(Tn(`axes${s}Move`,{value:t,source:i,controller:e,data:r}),0===n.axes[s]&&Tn(`axes${s}MoveStart`,{value:t,source:i,controller:e,data:r}),Math.abs(n.axes[s])<.5&&Math.abs(t)>.5&&Tn(`axes${s}MoveMiddle`,{value:t,source:i,controller:e,data:r}),0===t&&Tn(`axes${s}MoveEnd`,{value:t,source:i,controller:e,data:r}))}))),Mn.set(i,r)}}));const Rn=new be(.3,16,16);Rn.translate(0,.3,0);const Pn=new A({side:m,color:0,transparent:!0}),Fn=new d(Rn,Pn);function Cn(e,t,i,n,r){return e.copy(i),e.addScaledVector(n,t),e.addScaledVector(r,.5*t**2),e}Fn.rotation.set(Math.PI/2,0,0),Fn.position.set(0,0,-.3),Fn.visible=!1,$i.add(Fn),Pn.renderOrder=-101;const In=new e(0,-9.8,0),Ln=new e,Dn=new e,On=new e,Bn=new e,Nn=new U,kn=new Float32Array(33);kn.fill(0);const Gn=new Float32Array(33);Gn.fill(.5),Nn.setAttribute("position",new F(kn,3)),Nn.setAttribute("color",new F(Gn,3));const Un=new B({vertexColors:!0,blending:Ee}),Hn=new z(Nn,Un),Vn=new te(16772778,0,2),zn=(new g).load("./assets/target.png"),Qn=new d(new y(.3,.3,1,1),new A({map:zn,blending:Ee,color:5592405,transparent:!0}));Qn.rotation.x=-Math.PI/2;const jn=Ki.xr.getController(0);jn.addEventListener("selectstart",$n),jn.addEventListener("selectend",er),Yi.add(jn);let Xn=null;const Wn=Ki.xr.getController(1);Wn.addEventListener("selectstart",$n),Wn.addEventListener("selectend",er),Yi.add(Wn);const Yn=new Sn,qn=Ki.xr.getControllerGrip(0),Zn=Yn.createControllerModel(qn);qn.add(Zn),Yi.add(qn);const Kn=Ki.xr.getControllerGrip(1),Jn=Yn.createControllerModel(Kn);function $n(){Xn=this,Vn.intensity=1,this.add(Hn),Ji.add(Qn)}function er(){if(Xn===this){const e=Ki.xr.getCamera($i).getWorldPosition(Ln);e.y=0;const t=Xn.getWorldPosition(On),i=Xn.getWorldDirection(Bn);i.multiplyScalar(6);const n=(-i.y+Math.sqrt(i.y**2-2*t.y*In.y))/In.y;!function(e){Fn.visible=!0,Fn.material.opacity=0,new Wi.Tween(Fn.material).to({opacity:1},200).easing(Wi.Easing.Quadratic.Out).onComplete((function(){Yi.position.add(e),new Wi.Tween(Fn.material).to({opacity:0},200).onComplete((()=>Fn.visible=!1)).start()})).start()}(Cn(Dn,n,t,i,In).addScaledVector(e,-1)),Xn=null,Vn.intensity=0,this.remove(Hn),Ji.remove(Qn)}}function tr({detail:e}){e.value>0&&(Yi.rotation.y-=Math.PI/4),e.value<0&&(Yi.rotation.y+=Math.PI/4)}function ir({detail:e}){e.value<0&&$n.bind(e.controller)()}function nr({detail:e}){er.bind(e.controller)()}Kn.add(Jn),Yi.add(Kn),pn.add((()=>{if(Xn){const e=Xn.getWorldPosition(On),t=Xn.getWorldDirection(Bn);t.multiplyScalar(6);const i=(-t.y+Math.sqrt(t.y**2-2*e.y*In.y))/In.y,n=Ln.set(0,0,0);for(let r=1;r<=10;r++)Cn(n,r*i/10,e,t,In),Xn.worldToLocal(n),n.toArray(kn,3*r);Hn.geometry.attributes.position.needsUpdate=!0,Cn(Vn.position,.98*i,e,t,In),Cn(Qn.position,.98*i,e,t,In)}})),_n.addEventListener("axes0MoveMiddle",tr,!0),_n.addEventListener("axes2MoveMiddle",tr,!0),_n.addEventListener("axes1MoveMiddle",ir,!0),_n.addEventListener("axes3MoveMiddle",ir,!0),_n.addEventListener("axes1MoveEnd",nr,!0),_n.addEventListener("axes3MoveEnd",nr,!0);function rr(e,t,i,n,r,s){const a=e.image,{data:o}=a,l=3072*s;o[3*t+l+0]=i,o[3*t+l+1]=n,o[3*t+l+2]=r}function sr(e){return{spineTexture:{value:e},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}}}const ar=new J;const or=JSON.parse("[[[-1,0.15,1],[-1,0.15,-1],[-1.181,0,-2.783],[1.019,0.15,-2.352],[3.143,0.15,-1],[2,0.15,2]],[[0.585,0,4.602],[0.949,0.15,2.508],[-0.181,0,2.341],[0,0.15,1],[-1,0.15,-2],[-2.324,0,-1.334],[-2,0.15,1],[-3,0.15,4]],[[7.609,0.15,0.07],[10.305,0.15,0.851],[7.943,0.15,3.415],[5.731,0,4.937],[4.372,0,2.548],[5.874,0.15,1.987]],[[0.48,0,-3.013],[-0.927,0,-3.178],[-1.662,0,-2.851],[-2.895,0,-3.53],[-2.153,0,-5.519],[-0.731,0,-6.387],[0.406,0,-5.602],[0.845,0,-4.414]],[[-14.143,0,-1.582],[-12.974,0,-4.005],[-11.093,0,-4.994],[-8.276,0,-6.303],[-6.037,0,-5.134],[-5.598,0,-2.426],[-6.756,0,-0.779],[-9.308,0,-1.146],[-12.407,0,-0.196]],[[-11.268,0,3.552],[-8.877,0,4.241],[-8.752,0,2.78],[-7.076,0,2.479],[-4.63,0,3.15],[-3.283,0,1.436],[-2.555,0,0.182],[-3.448,0,-0.893],[-5.919,0,-0.658],[-7.421,0,0.33],[-9.554,0,-0.223],[-11.381,0,0.569]],[[-2.544,0,8.43],[-1.779,0,5.972],[-3.337,0,6.654],[-4.747,0,5.874],[-3.961,0,4.454],[-5.661,0,4.084],[-7.603,0,3.953],[-8.199,0,4.645],[-9.519,0,5.208],[-10.295,0,6.14],[-9.092,0,8.563],[-8.171,0,9.79],[-7.17,0,9.577],[-7.766,0,8.75],[-7.081,0,6.775],[-5.739,0,8.582],[-7.303,0,10.329]],[[-0.981,0,8.102],[-1.071,0,6.366],[3.132,0,4.779],[4.68,0,6.075],[3.931,0,8.25],[2.431,0,9.101],[0.694,0,7.657],[0.506,0,5.367],[3.035,0,5.493],[3.472,0,7.077],[2.381,0,7.836],[1.624,0,7.307]],[[-7.099,0,-12.514],[-5.901,0,-11.888],[-4.256,0,-10.233],[-6.128,0,-8.909],[-8.381,0,-10.521],[-7.53,0,-11.605]],[[3.87,0,-4.785],[5.653,0,-5.735],[7.329,0,-3.98],[6.057,0,-2.805],[3.998,0,-3.511]],[[5.328,0,6.344],[8.128,0,4.969],[9.063,0,7.791],[7.52,0,9.222],[5.288,0,8.956]],[[-7.21,0,-2.618],[-9.013,0,-3.601],[-10.172,0,-3.451],[-11.815,0,-6.614],[-13.207,0,-4.267],[-12.216,0,-3.248],[-12.023,0,-2.199],[-11.49,0,-0.99],[-10.077,0,-1.343],[-8.047,0,-1.694]],[[2.511,0,0.777],[2.704,0,-1.219],[0.312,0,-1.598],[0.46,0,0.008]],[[3.555,0,2.104],[3.226,0,0.983],[3.89,0,-0.925],[2.138,0,-2.237],[3.546,0,-3.144],[5.016,0,-2.35],[7.103,0,-2.382],[8.051,0,-1.758],[7.27,0,-0.42],[6.4,0,0.731],[5.509,0,1.609]],[[-10.346,0,3.433],[-10.866,0,2.243],[-10.492,0,0.366],[-8.583,0,0.556],[-8.364,0,1.895],[-9.473,0,3.43]],[[-7.572,0,1.525],[-6.665,0,0.787],[-5.618,0,-0.071],[-4.262,0,-0.293],[-4.249,0,0.875],[-3.816,0,1.763],[-5.145,0,2.699],[-6.298,0,2.251]],[[1.308,0,4.122],[1.6,0,3.036],[2.286,0,2.147],[3.58,0,2.658],[3.905,0,3.691],[3.346,0,4.412],[1.965,0,4.334]],[[-4.538,0,4.823],[-5.207,0,4.535],[-7.154,0,4.802],[-8.455,0,6.313],[-7.628,0,6.537],[-5.909,0,6.584],[-5.201,0,8.037],[-4.204,0,8.502],[-3.079,0,8.015],[-2.168,0,7.196],[-3.26,0,6.985],[-4.817,0,6.435],[-5.08,0,5.701]],[[-1.812,0,2.236],[-0.852,0,1.788],[-0.637,0,2.516],[0.672,0,2.919],[0.481,0,3.999],[-1.125,0,4.368],[-2.406,0,4.044]],[[-4.541,0,-2.186],[-3.62,0,-2.669],[-3.033,0,-1.838],[-3.649,0,-1.37]],[[1.18,0,-12.513],[2.768,0,-10.997],[3.464,0,-8.367],[1.437,0,-7.586],[0.156,0,-7.036],[-0.887,0,-8.682],[0.109,0,-10.614]],[[2.353,0,-5.524],[1.879,0,-6.822],[3.422,0,-7.657],[-1.599,0,-11.696],[-1.172,0,-10.717],[-2.005,0,-8.23],[-3.473,0,-6.588],[-5.197,0,-6.988],[-5.462,0,-8.365],[-3.999,0,-9.301],[-4.063,0,-11.428]],[[2.673,0,-7.133],[4.413,0,-7.885],[5.14,0,-6.248],[4.198,0,-5.599],[3.419,0,-5.143],[3.345,0,-4.144],[1.618,0,-3.875],[1.06,0,-4.785],[1.036,0,-6.336]],[[6.979,0,-9.945],[7.506,0,-4.59],[6.669,0,-6.427],[5.048,0,-8.403],[3.409,0,-10.188],[1.965,0,-12.822]],[[8.019,0,-3.865],[10.063,0,-3.804],[11.247,0,-5.626],[11.025,0,-4.073],[12.51,0,-5.346],[11.998,0,-3.846],[14.276,0,-3.373],[12.933,0,-2.573],[13.905,0,-1.157],[12.624,0,-1.534],[11.721,0,-0.445],[10.423,0,-1.439],[8.728,0,-3.016],[9.712,0,-4.664],[7.765,0,-5.505]],[[12.206,0,1.27],[12.956,0,2.156],[11.434,0,2.824],[13.371,0,3.806],[14.251,0,5.444],[12.494,0,6.359],[10.743,0,7.531],[10.03,0,6.089],[8.921,0,4.48]]]"),lr=JSON.parse("[[-8.166,-1.184,-3.625],[0.759,-0.118,0.201],[2.127,0,1.745],[-2.644,7.108,-0.629],[-8.293,0,4.19],[-4.026,0,6.005],[3.061,0,7.008],[6.414,0,-3.748],[5.725,0,-3.251],[0.736,0,-8.463],[0.716,0,-9.431]]"),cr=JSON.parse("[[-0.728,0,3.497],[-1.483,0,3.603],[7.124,0,2.894],[7.823,0,1.236],[-8.2,0,-3.662],[-7.197,0,-3.354],[-7.013,0,3.543],[-7.788,0,2.617],[-3.806,0,7.43],[-7.295,0,5.788],[1.6,0,7.936],[2.071,0,6.071],[6.452,0,6.896],[7.638,0,7.418],[11.143,0,5.576],[11.766,0,4.914],[12.005,0,-1.567],[11.59,0,-2.894],[-6.432,0,-10.409],[-6.034,0,-10.763],[2.065,0,-0.56],[1.382,0,-0.861],[5.85,0,-0.066],[4.992,0,0.311]]"),ur=or.map((t=>t.map((t=>(new e).fromArray(t))))),hr=lr.map((t=>(new e).fromArray(t))),dr=cr.map((t=>(new e).fromArray(t))),pr=new An;const Ar=async function(){const{scene:e}=await new Promise((e=>pr.load("./assets/forest.glb",e))),t=e.children[0];t.position.y=0,t.material.side=m,t.material.transparent=!0,t.material.opacity=.5;const{scene:i}=await new Promise((e=>pr.load("./assets/LilyPad.glb",e))),{scene:n}=await new Promise((e=>pr.load("./assets/LilyPad2.glb",e))),{scene:r}=await new Promise((e=>pr.load("./assets/fish.glb",e)));return{fish:r,lilyPad2:n,lilyPad1:i,trees:e,flotsam:t}}(),fr=["assets/piano/piano_mf_4_G.mp3","assets/piano/piano_mf_5_A.mp3","assets/piano/piano_mf_5_B.mp3","assets/piano/piano_mf_5_C.mp3","assets/piano/piano_mf_5_D.mp3","assets/piano/piano_mf_5_E.mp3","assets/piano/piano_mf_5_Gb.mp3","assets/piano/piano_mf_5_G.mp3"],mr=new Map;class gr{constructor(e,t){this.audioElement=e,this.source=t}setLocationAndPlay(e){this.source.setPosition(e.x,e.y,e.z),this.audioElement.play()}}let vr=!1;var yr=function(){var e=0,t=document.createElement("div");function i(e){return t.appendChild(e.dom),e}function n(i){for(var n=0;n<t.children.length;n++)t.children[n].style.display=n===i?"block":"none";e=i}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(i){i.preventDefault(),n(++e%t.children.length)}),!1);var r=(performance||Date).now(),s=r,a=0,o=i(new yr.Panel("FPS","#0ff","#002")),l=i(new yr.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=i(new yr.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:i,showPanel:n,begin:function(){r=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(l.update(e-r,200),e>=s+1e3&&(o.update(1e3*a/(e-s),100),s=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:t,setMode:n}};yr.Panel=function(e,t,i){var n=1/0,r=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,l=48*a,c=3*a,u=2*a,h=3*a,d=15*a,p=74*a,A=30*a,f=document.createElement("canvas");f.width=o,f.height=l,f.style.cssText="width:80px;height:48px";var m=f.getContext("2d");return m.font="bold "+9*a+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=i,m.fillRect(0,0,o,l),m.fillStyle=t,m.fillText(e,c,u),m.fillRect(h,d,p,A),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(h,d,p,A),{dom:f,update:function(l,g){n=Math.min(n,l),r=Math.max(r,l),m.fillStyle=i,m.globalAlpha=1,m.fillRect(0,0,o,d),m.fillStyle=t,m.fillText(s(l)+" "+e+" ("+s(n)+"-"+s(r)+")",c,u),m.drawImage(f,h+a,d,p-a,A,h,d,p-a,A),m.fillRect(h+p-a,d,a,A),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(h+p-a,d,a,s((1-l/g)*A))}}},window.canaudio.checked=!1,window.canaudio.addEventListener("change",(function(){this.checked?(!function(){if(vr)return;vr=!0;const t=new AudioContext,i=new ResonanceAudio(t);i.output.connect(t.destination);const n=new e,r=new e;pn.add((function(){n.set(0,0,-1),n.applyQuaternion($i.quaternion),r.set(0,1,0),r.applyQuaternion($i.quaternion),i.setListenerOrientation(n.x,n.y,n.z,r.x,r.y,r.z),i.setListenerPosition($i.position.x,$i.position.y,$i.position.z)}));for(const e of fr){const n=document.createElement("audio");n.src=e;const r=t.createMediaElementSource(n),s=i.createSource();r.connect(s.input);const a=new gr(n,s);mr.set(e,a)}}(),window.bgsound.play()):window.bgsound.pause()}));const wr=new yr;document.body.appendChild(wr.dom);const br=async function(){const{fish:e,trees:t,flotsam:i,lilyPad1:n,lilyPad2:r}=await Ar;for(const e of hr){const t=n.clone();t.position.copy(e),t.position.y=0,t.rotation.y=2*Math.PI*Math.random(),t.scale.multiplyScalar(.8+.4*Math.random()),hn.add(t)}for(const e of dr){const t=r.clone();t.position.copy(e),t.position.y=0,t.rotation.y=2*Math.PI*Math.random(),t.scale.multiplyScalar(.8+.4*Math.random()),hn.add(t)}hn.add(i),Ji.add(t);return{Fishes:class extends class extends class{constructor(e,t=1){const i=e.clone(),n=function(e){const t=new Float32Array(4096*e*3),i=new Me(t,1024,4*e,C,_e);return i.wrapS=v,i.wrapY=v,i.magFilter=re,i.needsUpdate=!0,i}(t),r=sr(n);i.traverse((function(e){(e instanceof d||e instanceof xe)&&(e.material=e.material.clone(),function(e,t,i){t=t||sr(),e.__ok||(e.__ok=!0,e.onBeforeCompile=e=>{if(e.__modified)return;e.__modified=!0,Object.assign(e.uniforms,t);const n=`\n\t\tuniform sampler2D spineTexture;\n\t\tuniform float pathOffset;\n\t\tuniform float pathSegment;\n\t\tuniform float spineOffset;\n\t\tuniform float spineLength;\n\t\tuniform int flow;\n\n\t\tfloat textureLayers = ${4*i}.;\n\t\tfloat textureStacks = 1.;\n\n\t\t${e.vertexShader}\n\t\t`.replace("#include <defaultnormal_vertex>","\n\t\tvec4 worldPos = modelMatrix * vec4(position, 1.);\n\n\t\tbool bend = flow > 0;\n\t\tfloat xWeight = bend ? 0. : 1.;\n\n\t\t#ifdef USE_INSTANCING\n\t\tfloat pathOffsetFromInstanceMatrix = instanceMatrix[3][2];\n\t\tfloat spineLengthFromInstanceMatrix = instanceMatrix[3][0];\n\t\tfloat spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;\n\t\tfloat mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;\n\t\t#else\n\t\tfloat spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;\n\t\tfloat mt = (spinePortion * pathSegment + pathOffset)*textureStacks;\n\t\t#endif\n\n\t\tmt = mod(mt, textureStacks);\n\t\tfloat rowOffset = floor(mt);\n\n\t\t#ifdef USE_INSTANCING\n\t\trowOffset += instanceMatrix[3][1] * 4.;\n\t\t#endif\n\n\t\tvec3 spinePos = texture(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;\n\t\tvec3 a =        texture(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;\n\t\tvec3 b =        texture(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;\n\t\tvec3 c =        texture(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;\n\t\tmat3 basis = mat3(a, b, c);\n\n\t\tvec3 transformed = basis\n\t\t\t* vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)\n\t\t\t+ spinePos;\n\n\t\tvec3 transformedNormal = normalMatrix * (basis * objectNormal);\n\t\t").replace("#include <begin_vertex>","").replace("#include <project_vertex>","\n\t\t\tvec4 mvPosition = viewMatrix * vec4( transformed, 1.0 );\n\t\t\t// vec4 mvPosition = viewMatrix * worldPos;\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t\t");e.vertexShader=n})}(e.material,r,t))})),this.curveArray=new Array(t),this.curveLengthArray=new Array(t),this.currentCurveCount=0,this.object3D=i,this.splineTexure=n,this.uniforms=r}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const i=t.getLength();this.uniforms.spineLength.value=i,this.curveLengthArray[e]=i,this.curveArray[e]=t,function(e,t,i){const n=Math.floor(1024);t.arcLengthDivisions=n/2,t.updateArcLengths();const r=t.getSpacedPoints(n),s=t.computeFrenetFrames(n,!0);for(let t=0;t<n;t++){let n=Math.floor(t/1024),a=t%1024,o=r[t];rr(e,a,o.x,o.y,o.z,0+n+4*i),o=s.tangents[t],rr(e,a,o.x,o.y,o.z,1+n+4*i),o=s.normals[t],rr(e,a,o.x,o.y,o.z,2+n+4*i),o=s.binormals[t],rr(e,a,o.x,o.y,o.z,3+n+4*i)}e.needsUpdate=!0}(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}{constructor(e,t,i,n){const r=new xe(i,n,e);r.instanceMatrix.setUsage(Se),super(r,t),this.offsets=new Array(e).fill(0),this.whichCurve=new Array(e).fill(0),this.count=e}writeChanges(e){ar.makeTranslation(this.curveLengthArray[this.whichCurve[e]],this.whichCurve[e],this.offsets[e]),this.object3D.setMatrixAt(e,ar),this.object3D.instanceMatrix.needsUpdate=!0}moveIndividualAlongCurve(e,t){this.offsets[e]+=t,this.writeChanges(e)}setCurve(e,t){if(isNaN(t))throw Error("curve index being set is Not a Number (NaN)");this.whichCurve[e]=t,this.writeChanges(e)}}{constructor(t,i){e.children[0].geometry.scale(.6,.6,.6),e.children[0].geometry.rotateZ(Math.PI),e.children[0].geometry.rotateY(-Math.PI/2),super(t,i,e.children[0].geometry,e.children[0].material)}}}}();!async function(){const{Fishes:e}=await br;let t=60;const i=(window.location.search||"").match(/^\?fish=(\d+)/);i&&(t=+i[1]);const n=new e(t,ur.length);Ji.add(n.object3D),window.fishes=n;for(let e=0;e<ur.length;e++){const t=new Te(ur[e]);t.curveType="centripetal",t.closed=!0,n.updateCurve(e,t)}const r=n.curveLengthArray.reduce(((e,t)=>e+t),0),s=n.curveLengthArray.map((e=>Math.round(t*e/r))),a=s.slice(0);for(let e=0;e<a.length;e++)a[e]+=0===e?0:a[e-1];for(let e=0;e<n.count;e++){const t=a.findIndex((t=>e<=t));n.setCurve(e,t),n.moveIndividualAlongCurve(e,1*e/s[t]),n.object3D.setColorAt(e,new M(`hsl(${Math.floor(50*Math.random())}, ${Math.floor(100*Math.random())}%, ${Math.floor(20+80*Math.random())}%)`))}pn.add((function(){for(let e=0;e<n.count;e++)n.moveIndividualAlongCurve(e,9e-4)})),pn.add((()=>wr.update()))}(),function(){const t=[],i=[],n=new Re(1,32),r=new e;n.rotateX(-Math.PI/2),n.vertices.splice(0,1);for(let e=0;e<15;e++){const e=new B({color:10066329,blending:Ee}),r=new Q(n,e);t.push(r),i.push(r)}!function e(){if(i.length>3){const e=i.splice(0,3),t=20*(Math.random()-.5),n=20*(Math.random()-.5);r.set(t,hn.position.y,n),window.canaudio.checked&&function(e){if(!vr)return;const t=Math.floor(Math.random()*fr.length);mr.get(fr[t]).setLocationAndPlay(e)}(r);for(let r=1;r<=3;r++){const s=e[r-1];s.position.set(t,-.1,n),setTimeout((()=>{s.scale.multiplyScalar(0),s.material.color.setHex(16777215),hn.add(s),setTimeout((()=>{hn.remove(s),i.push(s)}),3e3)}),800*r)}}setTimeout(e,1e3*Math.random())}();const s=new e(1,1,1).multiplyScalar(.018);pn.add((function(){for(const e of t){e.scale.add(s);const t=.99*(e.material.color.getHex()>>16),i=(t<<16)+(t<<8)+t;e.material.color.setHex(i)}}))}(),window.renderer=Ki,window.camera=$i,window.scene=Ji,"?editor"===location.search&&import("./editor.js");export{$i as a,Ki as b,ur as c,en as d,Ar as m,pn as r,Ji as s,hn as w};
//# sourceMappingURL=garden.js.map
